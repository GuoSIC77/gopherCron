var fe=Object.defineProperty;var M=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var O=(l,a,o)=>a in l?fe(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o,j=(l,a)=>{for(var o in a||(a={}))me.call(a,o)&&O(l,o,a[o]);if(M)for(var o of M(a))we.call(a,o)&&O(l,o,a[o]);return l};import{a as ve,r as h,c as S,w as I,a0 as pe,$ as _e,L as ge,o as le,cb as ke,h as G,b as he,aa as be,n as ye,cv as K,g as xe,ad as Ve,f as A,z as Fe,u as oe,k as b,l as $,x as g,y as ae,m as c,q as u,B as Q,K as se,D as B,G as E,H,Q as z,t as k,cw as Ce,cx as Ie,cy as Se,e as J,b_ as T,A as re,ar as Be,bk as ne,aD as D,v as W,s as Ee}from"./index.e18600f8.js";import{Q as ue}from"./QList.68ba6ad8.js";import{k as U,a as P,s as q,g as Qe}from"./use-prevent-scroll.d4f2a0d7.js";import{Q as $e}from"./QScrollArea.76dfba7f.js";import{a as X,b as Y,Q as Z}from"./QItem.85a3c29d.js";import{Q as Ae}from"./QBtnDropdown.1babfa60.js";import{Q as Ue,C as ee}from"./ClosePopup.665fa76c.js";import{_ as ie}from"./Confirm.6bb1b61d.js";import{a as te,b as De,Q as Ne}from"./QDialog.07d9a48e.js";import{a as Le}from"./QChip.1dbd295c.js";import{Q as Re}from"./QInput.75b94522.js";import{f as Te}from"./datetime.6205e5a7.js";import{t as We,b as Pe}from"./thumbStyle.856de4cb.js";import"./use-dark.f89e8300.js";import"./touch.1d111f56.js";import"./uid.81432f81.js";import"./focus-manager.32f8d49a.js";import"./position-engine.e707f0b1.js";import"./use-key-composition.4a5ce83a.js";const{passive:C}=be;var qe=ve({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:{default:void 0},initialIndex:Number,disable:Boolean,reverse:Boolean},emits:["load"],setup(l,{slots:a,emit:o}){const i=h(!1),n=h(!0),m=h(null);let t=l.initialIndex||0,e,d;const v=S(()=>"q-infinite-scroll__loading"+(i.value===!0?"":" invisible"));function p(){if(l.disable===!0||i.value===!0||n.value===!1)return;const f=U(e),F=P(e),R=K(e);l.reverse===!1?Math.round(F+R+l.offset)>=Math.round(f)&&y():Math.round(F)<=l.offset&&y()}function y(){if(l.disable===!0||i.value===!0||n.value===!1)return;t++,i.value=!0;const f=U(e);o("load",t,F=>{n.value===!0&&(i.value=!1,ye(()=>{if(l.reverse===!0){const R=U(e),de=P(e),ce=R-f;q(e,de+ce)}F===!0?w():m.value&&m.value.closest("body")&&d()}))})}function s(){t=0}function _(){n.value===!1&&(n.value=!0,e.addEventListener("scroll",d,C)),p()}function w(){n.value===!0&&(n.value=!1,i.value=!1,e.removeEventListener("scroll",d,C),d!==void 0&&d.cancel!==void 0&&d.cancel())}function r(){if(e&&n.value===!0&&e.removeEventListener("scroll",d,C),e=Qe(m.value,l.scrollTarget),n.value===!0){if(e.addEventListener("scroll",d,C),l.reverse===!0){const f=U(e),F=K(e);q(e,f-F)}p()}}function x(f){t=f}const V=xe();Object.assign(V.proxy,{poll:()=>{d!==void 0&&d()},trigger:y,stop:w,reset:s,resume:_,setIndex:x});function N(f){f=parseInt(f,10);const F=d;d=f<=0?p:Ve(p,isNaN(f)===!0?100:f),e&&n.value===!0&&(F!==void 0&&e.removeEventListener("scroll",F,C),e.addEventListener("scroll",d,C))}I(()=>l.disable,f=>{f===!0?w():_()}),I(()=>l.reverse,f=>{i.value===!1&&n.value===!0&&p()}),I(()=>l.scrollTarget,r),I(()=>l.debounce,N);let L=!1;return pe(()=>{L!==!1&&e&&q(e,L)}),_e(()=>{L=e?P(e):!1}),ge(()=>{n.value===!0&&e.removeEventListener("scroll",d,C)}),le(()=>{N(l.debounce),r()}),()=>{const f=ke(a.default,[]);return l.disable!==!0&&n.value===!0&&f[l.reverse===!1?"push":"unshift"](G("div",{class:v.value},he(a.loading))),G("div",{class:"q-infinite-scroll",ref:m},f)}}});const ze=A({props:{workflowId:{type:Number,required:!0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:a}){const o=l,i=S({get:()=>o.modelValue,set:d=>a("update:modelValue",d)}),n=Fe(),m=oe(),t=S(()=>m.state.WorkFlow.workflows.get(o.workflowId));async function e(d){m.commit("cleanError"),await m.dispatch("WorkFlow/deleteWorkFlow",{id:d}),m.state.Root.currentError===void 0&&(n.push({name:"workflows"}),i.value=!1)}return(d,v)=>{var p;return b(),$(ie,{modelValue:g(i),"onUpdate:modelValue":v[0]||(v[0]=y=>ae(i)?i.value=y:null),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1\u7F16\u6392 "+((p=g(t))==null?void 0:p.title)+" ?",type:"warning",onConfirm:v[1]||(v[1]=y=>g(t)&&e(g(t).id))},null,8,["modelValue","content"])}}}),He=k("div",{class:"text-h6"},"\u4EFB\u52A1\u7F16\u6392\u4EBA\u5458\u7BA1\u7406",-1),Me=B(" \u6DFB\u52A0 "),Oe=A({props:{workflowId:{type:Number,default:0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:a}){const o=l,i=S({get:()=>o.modelValue,set:w=>a("update:modelValue",w)}),n=h([]);async function m(){n.value=await Ce(o.workflowId)}I(()=>[o.workflowId,i.value],async([,w])=>{w&&m(),t.value=""});const t=h(""),e=h(!1);async function d(){e.value=!0;try{await Ie(o.workflowId,t.value),t.value="",await m()}finally{e.value=!1}}const v=h(),p=h(!1);function y(w){v.value=w,p.value=!0}function s(){v.value=void 0,p.value=!1}async function _(w){e.value=!0;try{await Se(o.workflowId,w.id),await m()}finally{e.value=!1}}return(w,r)=>(b(),$(Ne,{modelValue:g(i),"onUpdate:modelValue":r[3]||(r[3]=x=>ae(i)?i.value=x:null)},{default:c(()=>{var x;return[u(ie,{modelValue:p.value,"onUpdate:modelValue":r[0]||(r[0]=V=>p.value=V),type:"warning",content:`\u786E\u5B9A\u8981\u79FB\u9664\u7528\u6237 ${(x=v.value)==null?void 0:x.name} \u5417\uFF1F`,onConfirm:r[1]||(r[1]=V=>v.value&&_(v.value).then(s))},null,8,["modelValue","content"]),u(De,{class:"tw-w-96 q-pa-sm"},{default:c(()=>[u(te,null,{default:c(()=>[He]),_:1}),u(te,null,{default:c(()=>[(b(!0),Q(H,null,se(n.value,V=>(b(),$(Le,{key:V.id,removable:"",color:"primary","text-color":"black",onRemove:N=>y(V)},{default:c(()=>[B(E(V.name),1)]),_:2},1032,["onRemove"]))),128))]),_:1}),u(Ue,null,{default:c(()=>[u(Re,{modelValue:t.value,"onUpdate:modelValue":r[2]||(r[2]=V=>t.value=V),class:"tw-w-full",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u5E10\u53F7"},{append:c(()=>[u(z,{loading:e.value,flat:"",icon:"add","text-color":"primary",onClick:d},{default:c(()=>[Me]),_:1},8,["loading"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]}),_:1},8,["modelValue"]))}}),je=B("\u4EBA\u5458\u7BA1\u7406"),Ge=B("\u5220\u9664"),Ke=A({props:{workflowId:{type:Number,required:!0}},setup(l){const a=l,o=h(!1),i=h(!1),n=h(!1);return(m,t)=>(b(),Q(H,null,[u(ze,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),"workflow-id":a.workflowId},null,8,["modelValue","workflow-id"]),u(Oe,{modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value=e),"workflow-id":a.workflowId},null,8,["modelValue","workflow-id"]),u(Ae,{modelValue:o.value,"onUpdate:modelValue":t[4]||(t[4]=e=>o.value=e),dense:"",flat:"","dropdown-icon":"more_horiz","no-icon-animation":"",onClick:t[5]||(t[5]=T(()=>{},["stop","prevent"]))},{default:c(()=>[u(ue,{dense:""},{default:c(()=>[J((b(),$(Z,{clickable:"",class:"hover:tw-bg-primary hover:tw-text-black",onClick:t[2]||(t[2]=T(e=>n.value=!0,["stop"]))},{default:c(()=>[u(X,null,{default:c(()=>[u(Y,null,{default:c(()=>[je]),_:1})]),_:1})]),_:1})),[[ee]]),J((b(),$(Z,{clickable:"",class:"hover:tw-bg-primary hover:tw-text-black",onClick:t[3]||(t[3]=T(e=>i.value=!0,["stop"]))},{default:c(()=>[u(X,null,{default:c(()=>[u(Y,null,{default:c(()=>[Ge]),_:1})]),_:1})]),_:1})),[[ee]])]),_:1})]),_:1},8,["modelValue"])],64))}});const Je={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Xe={class:"q-pa-md tw-flex tw-flex-row-reverse tw-gap-4"},Ye={class:"tw-w-full tw-grow tw-overflow-hidden"},Ze={class:"task__cron"},et={class:"task__remark"},tt={class:"task__bottom-box"},lt={class:"task__bottom-time"},ot={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},at=B(" \u6682\u65E0\u6570\u636E "),st=A({setup(l){const a=oe(),o=re(),i=h(),n=S(()=>a.state.Root.loadingWorkflows);I(()=>o.name,s=>{(s==null?void 0:s.toString())==="workflows"&&v()});function m(s){const _=i.value;if(_===void 0)throw new Error("scroll-area instance is missing");const w=Array.from(t.value.keys()),r=w.findIndex(x=>x===s);setTimeout(()=>{if(r<0)_.setScrollPercentage("vertical",1);else{const x=1*r/w.length*_.getScroll().verticalSize-50;_.setScrollPosition("vertical",x)}},100)}le(async()=>{a.watch(s=>[s.Root.eventWorkFlow],([s])=>{if(!s)return;const _=t.value.get(s.workFlowId);_!==void 0&&a.commit("success",{message:`\u4EFB\u52A1\u7F16\u6392 ${_.title} \u5F53\u524D\u72B6\u6001: ${s.status}`}),v()}),I(()=>[t.value],()=>{const s=Number(o.params.workflowId);s!==0&&!isNaN(s)&&m(s)},{deep:!0})});const t=S(()=>a.state.WorkFlow.workflows);async function e(s,_){d.page=s,(await v()).length<d.pageSize?_(!0):_(!1)}const d=Be({page:1,pageSize:5});async function v(){const[s]=await a.dispatch("WorkFlow/fetchWorkFlows",j({},d));return s}function p(s){return s.id===Number(o.params.workflowId||0)}function y(s){return s.state&&s.state.status==="running"}return(s,_)=>{const w=ne("router-link");return b(),Q("div",Je,[k("div",Xe,[u(z,{flat:"",loading:g(n),icon:"refresh",onClick:v},null,8,["loading"]),u(z,{flat:"",icon:"add",to:{name:"create_workflow"}})]),k("div",Ye,[u(g($e),{ref_key:"scrollArea",ref:i,visible:"","thumb-style":g(We),"bar-style":g(Pe),class:"tw-w-full tw-h-full tw-px-[15px]"},{default:c(()=>[u(g(qe),{class:"tw-w-full tw-h-full",offset:100,onLoad:e},{default:c(()=>[u(ue,{class:"tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:c(()=>[(b(!0),Q(H,null,se(g(t),([,r])=>(b(),$(w,{key:r.id,to:{name:"workflow",params:{workflowId:r.id}}},{default:c(()=>[k("div",{class:D((p(r)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-pt-[30px] tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[k("div",{class:D("task__status"+r.status)},E(y(r)?"\u6267\u884C\u4E2D":r.status==1?"\u8C03\u5EA6\u4E2D":"\u5DF2\u6682\u505C"),3),k("div",{class:D((p(r)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[k("div",Ze,[u(W,{name:"schedule"}),B(" "+E(r.cronExpr),1)]),u(W,{name:"numbers"}),B(" "+E(r.title),1)],2),k("div",et,E(r.remark||"-"),1),k("div",tt,[k("div",lt,E(g(Te)(r.createTime*1e3)),1),u(Ke,{"workflow-id":r.id},null,8,["workflow-id"])])],2)]),_:2},1032,["to"]))),128))]),_:1})]),_:1})]),_:1},8,["thumb-style","bar-style"]),!g(n)&&(!g(t)||g(t).size===0)?(b(),Q("div",ot,[u(W,{name:"outlet",style:{"font-size":"3rem"}}),at])):Ee("",!0)])])}}}),rt={class:"lg:q-pa-md tw-box-border tw-flex tw-flex-row tw-gap-4 tw-h-full tw-w-full"},nt={class:"tw-w-full tw-h-full tw-grow tw-overflow-hidden"},St=A({setup(l){const a=re(),o=S(()=>a.name&&a.name.toString()!=="workflows"?"tw-hidden lg:tw-block":"");return(i,n)=>{const m=ne("router-view");return b(),Q("div",rt,[k("div",{class:D("xl:tw-basis-1/5 lg:tw-basis-1/4  tw-h-full tw-w-full tw-shrink-0 "+g(o))},[u(st)],2),k("div",nt,[u(m)])])}}});export{St as default};

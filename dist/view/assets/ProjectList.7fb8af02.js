import{f as E,c as w,z as le,u as R,k as c,l as g,x as d,y as N,r as V,o as O,j as oe,m as o,q as e,B as _,e as U,Q as C,w as ae,K as G,D as h,G as H,H as z,t as L,cq as ue,cj as D,cr as se,cs as re,b_ as F,bk as K,s as P,v as M,aD as T,A as J}from"./index.e18600f8.js";import{Q as B}from"./QInput.75b94522.js";import{Q as W}from"./QList.68ba6ad8.js";import{Q as ne}from"./QScrollArea.76dfba7f.js";import{_ as X}from"./Confirm.6bb1b61d.js";import{a as Q,b as Y,Q as Z}from"./QDialog.07d9a48e.js";import{Q as de}from"./QForm.7e1af889.js";import{C as $,Q as ie}from"./ClosePopup.665fa76c.js";import{a as S,b as A,Q as q}from"./QItem.85a3c29d.js";import{Q as me}from"./QBtnDropdown.1babfa60.js";import{a as ce}from"./QChip.1dbd295c.js";import{t as pe,b as fe}from"./thumbStyle.856de4cb.js";import"./use-key-composition.4a5ce83a.js";import"./use-dark.f89e8300.js";import"./uid.81432f81.js";import"./focus-manager.32f8d49a.js";import"./touch.1d111f56.js";import"./use-prevent-scroll.d4f2a0d7.js";import"./position-engine.e707f0b1.js";const ee=E({props:{projectId:{type:Number,required:!0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(j,{emit:p}){const i=j,u=w({get:()=>i.modelValue,set:a=>p("update:modelValue",a)}),m=le(),s=R(),f=w(()=>s.state.Project.projects.find(a=>a.id===i.projectId));async function t(a){s.commit("cleanError"),await s.dispatch("deleteProject",{projectId:a}),s.state.Root.currentError===void 0&&(m.push({name:"projects"}),u.value=!1)}return(a,v)=>{var b;return c(),g(X,{modelValue:d(u),"onUpdate:modelValue":v[0]||(v[0]=l=>N(u)?u.value=l:null),content:"\u662F\u5426\u8981\u5220\u9664\u9879\u76EE"+((b=d(f))==null?void 0:b.title)+"?",type:"warning",onConfirm:v[1]||(v[1]=l=>d(f)&&t(d(f).id))},null,8,["modelValue","content"])}}}),ve={key:0,class:"text-h6"},we={key:1,class:"text-h6"},te=E({props:{projectId:{type:Number,default:0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(j,{emit:p}){const i=j,u=w({get:()=>i.modelValue,set:l=>p("update:modelValue",l)}),m=R(),s=w(()=>m.state.Project.projects.find(l=>l.id===i.projectId)),f=w(()=>{const l=s.value;return{title:(l==null?void 0:l.title)||"",remark:(l==null?void 0:l.remark)||""}}),t=V(f.value),a=w(()=>{const l=t.value,r=f.value;return l.title.trim()===r.title.trim()&&l.remark.trim()===r.remark.trim()}),v=w(()=>t.value.title.trim()!==""&&!a.value);O(()=>{oe(()=>{u.value||(t.value=Object.assign({},f.value))})});async function b(){const l=t.value;m.commit("cleanError"),i.projectId>0?await m.dispatch("updateProject",{projectId:i.projectId,title:l.title.trim(),remark:l.remark.trim()}):await m.dispatch("createProject",{title:l.title.trim(),remark:l.remark.trim()}),m.state.Root.currentError===void 0&&(u.value=!1)}return(l,r)=>(c(),g(Z,{modelValue:d(u),"onUpdate:modelValue":r[2]||(r[2]=y=>N(u)?u.value=y:null),"no-backdrop-dismiss":!d(a)},{default:o(()=>[e(Y,{class:"tw-w-96 q-pa-sm"},{default:o(()=>[e(de,{onSubmit:b},{default:o(()=>[e(Q,null,{default:o(()=>[d(s)===void 0?(c(),_("div",ve,"\u521B\u5EFA\u9879\u76EE")):(c(),_("div",we,"\u7F16\u8F91\u9879\u76EE"))]),_:1}),e(Q,null,{default:o(()=>[e(B,{modelValue:t.value.title,"onUpdate:modelValue":r[0]||(r[0]=y=>t.value.title=y),type:"text",label:"\u9879\u76EE\u540D",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(B,{modelValue:t.value.remark,"onUpdate:modelValue":r[1]||(r[1]=y=>t.value.remark=y),type:"textarea",label:"\u5907\u6CE8",square:"",filled:""},null,8,["modelValue"])]),_:1}),e(Q,{align:"right",class:"tw-flex tw-gap-4 tw-flex-col-reverse lg:tw-flex-row lg:tw-justify-end"},{default:o(()=>[U(e(C,{flat:"",label:"\u53D6\u6D88",class:"lg:tw-w-24 tw-w-full"},null,512),[[$]]),e(C,{color:"primary","text-color":"black",type:"submit",label:d(s)===void 0?"\u521B\u5EFA":"\u4FDD\u5B58",disable:!d(v),class:"lg:tw-w-24 tw-w-full"},null,8,["label","disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","no-backdrop-dismiss"]))}}),Ve=L("div",{class:"text-h6"},"\u9879\u76EE\u4EBA\u5458\u7BA1\u7406",-1),be=h(" \u6DFB\u52A0 "),je=E({props:{projectId:{type:Number,default:0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(j,{emit:p}){const i=j,u=w({get:()=>i.modelValue,set:n=>p("update:modelValue",n)}),m=V([]);async function s(){m.value=await ue(D,i.projectId)}ae(()=>[i.projectId,u.value],async([,n])=>{n&&s(),f.value=""});const f=V(""),t=V(!1);async function a(){t.value=!0;try{await se(D,i.projectId,f.value),f.value="",await s()}finally{t.value=!1}}const v=V(),b=V(!1);function l(n){v.value=n,b.value=!0}function r(){v.value=void 0,b.value=!1}async function y(n){t.value=!0;try{await re(D,i.projectId,n.id),await s()}finally{t.value=!1}}return(n,k)=>(c(),g(Z,{modelValue:d(u),"onUpdate:modelValue":k[3]||(k[3]=I=>N(u)?u.value=I:null)},{default:o(()=>{var I;return[e(X,{modelValue:b.value,"onUpdate:modelValue":k[0]||(k[0]=x=>b.value=x),type:"warning",content:`\u786E\u5B9A\u8981\u79FB\u9664\u7528\u6237 ${(I=v.value)==null?void 0:I.name} \u5417\uFF1F`,onConfirm:k[1]||(k[1]=x=>v.value&&y(v.value).then(r))},null,8,["modelValue","content"]),e(Y,{class:"tw-w-96 q-pa-sm"},{default:o(()=>[e(Q,null,{default:o(()=>[Ve]),_:1}),e(Q,null,{default:o(()=>[(c(!0),_(z,null,G(m.value,x=>(c(),g(ce,{key:x.id,removable:"",color:"primary","text-color":"black",onRemove:Ue=>l(x)},{default:o(()=>[h(H(x.name),1)]),_:2},1032,["onRemove"]))),128))]),_:1}),e(ie,null,{default:o(()=>[e(B,{modelValue:f.value,"onUpdate:modelValue":k[2]||(k[2]=x=>f.value=x),class:"tw-w-full",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u5E10\u53F7"},{append:o(()=>[e(C,{loading:t.value,flat:"",icon:"add","text-color":"primary",onClick:a},{default:o(()=>[be]),_:1},8,["loading"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]}),_:1},8,["modelValue"]))}}),ye=h("\u7F16\u8F91"),_e=h("\u4EBA\u5458\u7BA1\u7406"),ge=h("\u5220\u9664"),ke=E({props:{projectId:{type:Number,required:!0}},setup(j){const p=j,i=V(!1),u=V(!1),m=V(!1),s=V(!1);return(f,t)=>(c(),_(z,null,[e(ee,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),"project-id":p.projectId},null,8,["modelValue","project-id"]),e(te,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=a=>m.value=a),"project-id":p.projectId},null,8,["modelValue","project-id"]),e(je,{modelValue:s.value,"onUpdate:modelValue":t[2]||(t[2]=a=>s.value=a),"project-id":p.projectId},null,8,["modelValue","project-id"]),e(me,{modelValue:i.value,"onUpdate:modelValue":t[6]||(t[6]=a=>i.value=a),flat:"","dropdown-icon":"more_horiz","no-icon-animation":""},{default:o(()=>[e(W,{dense:""},{default:o(()=>[U((c(),g(q,{clickable:"",class:"hover:tw-bg-primary hover:tw-text-black",onClick:t[3]||(t[3]=F(a=>m.value=!0,["stop"]))},{default:o(()=>[e(S,null,{default:o(()=>[e(A,null,{default:o(()=>[ye]),_:1})]),_:1})]),_:1})),[[$]]),U((c(),g(q,{clickable:"",class:"hover:tw-bg-primary hover:tw-text-black",onClick:t[4]||(t[4]=F(a=>s.value=!0,["stop"]))},{default:o(()=>[e(S,null,{default:o(()=>[e(A,null,{default:o(()=>[_e]),_:1})]),_:1})]),_:1})),[[$]]),U((c(),g(q,{clickable:"",class:"hover:tw-bg-primary hover:tw-text-black",onClick:t[5]||(t[5]=F(a=>u.value=!0,["stop"]))},{default:o(()=>[e(S,null,{default:o(()=>[e(A,null,{default:o(()=>[ge]),_:1})]),_:1})]),_:1})),[[$]])]),_:1})]),_:1},8,["modelValue"])],64))}}),xe={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},he={class:"q-pa-md tw-flex tw-justify-around"},Ce={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},Ee=h(" \u6682\u65E0\u6570\u636E "),Qe=E({setup(j){const p=R(),i=w(()=>p.state.Project.loadingProjects);async function u(){await p.dispatch("Project/fetchProjects")}O(u);const m=V(""),s=w(()=>p.state.Project.projects.filter(l=>l.title.indexOf(m.value)>=0||l.id.toString().indexOf(m.value)>=0));function f(l){return J().params.projectId===l.id.toString()}const t=V(!1),a=V(!1),v=w(()=>s.value.filter(f).pop()),b=w(()=>p.getters.isAdmin);return(l,r)=>{const y=K("router-link");return c(),_("div",xe,[d(v)?(c(),g(ee,{key:0,modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=n=>a.value=n),"project-id":d(v).id},null,8,["modelValue","project-id"])):P("",!0),e(te,{modelValue:t.value,"onUpdate:modelValue":r[1]||(r[1]=n=>t.value=n)},null,8,["modelValue"]),L("div",he,[e(B,{modelValue:m.value,"onUpdate:modelValue":r[2]||(r[2]=n=>m.value=n),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:o(()=>[e(M,{name:"search"})]),_:1},8,["modelValue"]),e(C,{flat:"",dense:"",loading:d(i),icon:"refresh",onClick:u},null,8,["loading"]),e(C,{flat:"",dense:"",icon:"add",onClick:r[3]||(r[3]=n=>t.value=!0)}),e(C,{flat:"",dense:"",class:"tw-text-red-300 lg:tw-flex tw-hidden",icon:"delete",disable:!d(v),onClick:r[4]||(r[4]=n=>a.value=!0)},null,8,["disable"])]),e(ne,{class:"tw-grow tw-px-[15px]",visible:"","thumb-style":d(pe),"bar-style":d(fe)},{default:o(()=>[e(W,{class:"tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:o(()=>[(c(!0),_(z,null,G(d(s),n=>(c(),_("div",{key:n.id,class:T((f(n)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-flex tw-flex-row tw-rounded-md")},[e(y,{class:"tw-grow tw-p-4",to:{name:"project",params:{projectId:n.id}}},{default:o(()=>[h(H(n.title),1)]),_:2},1032,["to"]),d(b)?(c(),g(ke,{key:0,"project-id":n.id},null,8,["project-id"])):P("",!0)],2))),128))]),_:1}),!d(i)&&(!d(s)||d(s).length===0)?(c(),_("div",Ce,[e(M,{name:"outlet",style:{"font-size":"3rem"}}),Ee])):P("",!0)]),_:1},8,["thumb-style","bar-style"])])}}}),Ie={class:"lg:tw-flex lg:tw-flex-row tw-w-full tw-h-full"},We=E({setup(j){const p=J(),i=w(()=>p.name&&p.name.toString()!=="projects"?"tw-hidden lg:tw-block":"");return(u,m)=>{const s=K("router-view");return c(),_("div",Ie,[L("div",{class:T("xl:tw-basis-1/5 tw-basis-1/4 tw-h-full tw-w-full "+d(i))},[e(Qe)],2),e(s)])}}});export{We as default};

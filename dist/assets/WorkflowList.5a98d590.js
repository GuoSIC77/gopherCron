var pe=Object.defineProperty;var O=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var J=(l,n,a)=>n in l?pe(l,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[n]=a,G=(l,n)=>{for(var a in n||(n={}))ge.call(n,a)&&J(l,a,n[a]);if(O)for(var a of O(n))_e.call(n,a)&&J(l,a,n[a]);return l};import{a as he,r as _,c as C,w as F,a4 as ke,a3 as be,S as xe,o as se,cf as ye,h as K,b as Ve,af as Se,n as X,cA as Y,ai as Fe,g as Be,j as N,B as Ce,u as ne,l as x,m as A,z as p,A as re,q as f,s as i,E as Q,N as ue,F as B,I as E,J as j,Q as M,x as b,cB as Ie,cC as Ee,cD as Qe,f as Z,c3 as W,D as ie,aw as Ae,bp as de,aI as H,y as P,t as $e}from"./index.858abf03.js";import{Q as Ne,a as Ue}from"./QBadge.aa8875bd.js";import{Q as ce}from"./QList.53c0d763.js";import{t as U,b as q,d as z,g as De}from"./use-prevent-scroll.a5760f87.js";import{Q as Le}from"./QScrollArea.ce37051a.js";import{a as ee,b as te,Q as le}from"./QItem.b0539e07.js";import{Q as Re}from"./QBtnDropdown.2416f369.js";import{Q as Te,C as oe}from"./ClosePopup.411262dd.js";import{_ as fe}from"./Confirm.200ef114.js";import{a as ae,b as We,Q as Pe}from"./QDialog.eb528cda.js";import{a as qe}from"./QChip.48edc830.js";import{Q as ze}from"./QInput.39515e5e.js";import{f as Me}from"./datetime.6205e5a7.js";import{t as He,b as je}from"./thumbStyle.856de4cb.js";import"./focus-manager.2ec597e1.js";import"./touch.9357bf86.js";import"./format.865294d5.js";import"./uid.42677368.js";import"./use-key-composition.89abe8dc.js";const{passive:I}=Se;var Oe=he({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:{default:void 0},initialIndex:Number,disable:Boolean,reverse:Boolean},emits:["load"],setup(l,{slots:n,emit:a}){const r=_(!1),d=_(!0),m=_(null),t=_(null);let c=l.initialIndex||0,e,s;const h=C(()=>"q-infinite-scroll__loading"+(r.value===!0?"":" invisible"));function k(){if(l.disable===!0||r.value===!0||d.value===!1)return;const w=U(e),V=q(e),$=Y(e);l.reverse===!1?Math.round(V+$+l.offset)>=Math.round(w)&&o():Math.round(V)<=l.offset&&o()}function o(){if(l.disable===!0||r.value===!0||d.value===!1)return;c++,r.value=!0;const w=U(e);a("load",c,V=>{d.value===!0&&(r.value=!1,X(()=>{if(l.reverse===!0){const $=U(e),me=q(e),ve=$-w;z(e,me+ve)}V===!0?u():m.value&&m.value.closest("body")&&s()}))})}function g(){c=0}function v(){d.value===!1&&(d.value=!0,e.addEventListener("scroll",s,I)),k()}function u(){d.value===!0&&(d.value=!1,r.value=!1,e.removeEventListener("scroll",s,I),s!==void 0&&s.cancel!==void 0&&s.cancel())}function y(){if(e&&d.value===!0&&e.removeEventListener("scroll",s,I),e=De(m.value,l.scrollTarget),d.value===!0){if(e.addEventListener("scroll",s,I),l.reverse===!0){const w=U(e),V=Y(e);z(e,w-V)}k()}}function S(w){c=w}function D(w){w=parseInt(w,10);const V=s;s=w<=0?k:Fe(k,isNaN(w)===!0?100:w),e&&d.value===!0&&(V!==void 0&&e.removeEventListener("scroll",V,I),e.addEventListener("scroll",s,I))}function L(w){if(R.value===!0){if(t.value===null){w!==!0&&X(()=>{L(!0)});return}const V=`${r.value===!0?"un":""}pauseAnimations`;Array.from(t.value.getElementsByTagName("svg")).forEach($=>{$[V]()})}}const R=C(()=>l.disable!==!0&&d.value===!0);F([r,R],()=>{L()}),F(()=>l.disable,w=>{w===!0?u():v()}),F(()=>l.reverse,()=>{r.value===!1&&d.value===!0&&k()}),F(()=>l.scrollTarget,y),F(()=>l.debounce,D);let T=!1;ke(()=>{T!==!1&&e&&z(e,T)}),be(()=>{T=e?q(e):!1}),xe(()=>{d.value===!0&&e.removeEventListener("scroll",s,I)}),se(()=>{D(l.debounce),y(),r.value===!1&&L()});const we=Be();return Object.assign(we.proxy,{poll:()=>{s!==void 0&&s()},trigger:o,stop:u,reset:g,resume:v,setIndex:S}),()=>{const w=ye(n.default,[]);return R.value===!0&&w[l.reverse===!1?"push":"unshift"](K("div",{ref:t,class:h.value},Ve(n.loading))),K("div",{class:"q-infinite-scroll",ref:m},w)}}});const Je=N({props:{workflowId:{type:Number,required:!0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:n}){const a=l,r=C({get:()=>a.modelValue,set:e=>n("update:modelValue",e)}),d=Ce(),m=ne(),t=C(()=>m.state.WorkFlow.workflows.get(a.workflowId));async function c(e){m.commit("cleanError"),await m.dispatch("WorkFlow/deleteWorkFlow",{id:e}),m.state.Root.currentError===void 0&&(d.push({name:"workflows"}),r.value=!1)}return(e,s)=>{var h;return x(),A(fe,{modelValue:p(r),"onUpdate:modelValue":s[0]||(s[0]=k=>re(r)?r.value=k:null),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1\u7F16\u6392 "+((h=p(t))==null?void 0:h.title)+" ?",type:"warning",onConfirm:s[1]||(s[1]=k=>p(t)&&c(p(t).id))},null,8,["modelValue","content"])}}}),Ge=b("div",{class:"text-h6"},"\u4EFB\u52A1\u7F16\u6392\u4EBA\u5458\u7BA1\u7406",-1),Ke=B(" \u6DFB\u52A0 "),Xe=N({props:{workflowId:{type:Number,default:0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:n}){const a=l,r=C({get:()=>a.modelValue,set:v=>n("update:modelValue",v)}),d=_([]);async function m(){d.value=await Ie(a.workflowId)}F(()=>[a.workflowId,r.value],async([,v])=>{v&&m(),t.value=""});const t=_(""),c=_(!1);async function e(){c.value=!0;try{await Ee(a.workflowId,t.value),t.value="",await m()}finally{c.value=!1}}const s=_(),h=_(!1);function k(v){s.value=v,h.value=!0}function o(){s.value=void 0,h.value=!1}async function g(v){c.value=!0;try{await Qe(a.workflowId,v.id),await m()}finally{c.value=!1}}return(v,u)=>(x(),A(Pe,{modelValue:p(r),"onUpdate:modelValue":u[3]||(u[3]=y=>re(r)?r.value=y:null)},{default:f(()=>{var y;return[i(fe,{modelValue:h.value,"onUpdate:modelValue":u[0]||(u[0]=S=>h.value=S),type:"warning",content:`\u786E\u5B9A\u8981\u79FB\u9664\u7528\u6237 ${(y=s.value)==null?void 0:y.name} \u5417\uFF1F`,onConfirm:u[1]||(u[1]=S=>s.value&&g(s.value).then(o))},null,8,["modelValue","content"]),i(We,{class:"tw-w-96 q-pa-sm"},{default:f(()=>[i(ae,null,{default:f(()=>[Ge]),_:1}),i(ae,null,{default:f(()=>[(x(!0),Q(j,null,ue(d.value,S=>(x(),A(qe,{key:S.id,removable:"",color:"primary","text-color":"black",onRemove:D=>k(S)},{default:f(()=>[B(E(S.name),1)]),_:2},1032,["onRemove"]))),128))]),_:1}),i(Te,null,{default:f(()=>[i(ze,{modelValue:t.value,"onUpdate:modelValue":u[2]||(u[2]=S=>t.value=S),class:"tw-w-full",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u5E10\u53F7"},{append:f(()=>[i(M,{loading:c.value,flat:"",icon:"add","text-color":"primary",onClick:e},{default:f(()=>[Ke]),_:1},8,["loading"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]}),_:1},8,["modelValue"]))}}),Ye=B("\u4EBA\u5458\u7BA1\u7406"),Ze=B("\u5220\u9664"),et=N({props:{workflowId:{type:Number,required:!0}},setup(l){const n=l,a=_(!1),r=_(!1),d=_(!1);return(m,t)=>(x(),Q(j,null,[i(Je,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=c=>r.value=c),"workflow-id":n.workflowId},null,8,["modelValue","workflow-id"]),i(Xe,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=c=>d.value=c),"workflow-id":n.workflowId},null,8,["modelValue","workflow-id"]),i(Re,{modelValue:a.value,"onUpdate:modelValue":t[4]||(t[4]=c=>a.value=c),dense:"",flat:"","dropdown-icon":"more_horiz","no-icon-animation":"",onClick:t[5]||(t[5]=W(()=>{},["stop","prevent"]))},{default:f(()=>[i(ce,{dense:""},{default:f(()=>[Z((x(),A(le,{clickable:"",class:"hover:tw-bg-primary hover:tw-text-black",onClick:t[2]||(t[2]=W(c=>d.value=!0,["stop"]))},{default:f(()=>[i(ee,null,{default:f(()=>[i(te,null,{default:f(()=>[Ye]),_:1})]),_:1})]),_:1})),[[oe]]),Z((x(),A(le,{clickable:"",class:"hover:tw-bg-primary hover:tw-text-black",onClick:t[3]||(t[3]=W(c=>r.value=!0,["stop"]))},{default:f(()=>[i(ee,null,{default:f(()=>[i(te,null,{default:f(()=>[Ze]),_:1})]),_:1})]),_:1})),[[oe]])]),_:1})]),_:1},8,["modelValue"])],64))}});const tt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},lt={class:"q-pa-md tw-flex tw-flex-row-reverse tw-gap-4"},ot={class:"tw-w-full tw-grow tw-overflow-hidden tw-min-w-[280px]"},at={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},st={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},nt={class:"task__remark"},rt={class:"task__bottom-box"},ut={class:"task__bottom-time"},it={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},dt=B(" \u6682\u65E0\u6570\u636E "),ct=N({setup(l){const n=ne(),a=ie(),r=_(),d=C(()=>n.state.Root.loadingWorkflows);F(()=>a.name,o=>{(o==null?void 0:o.toString())==="workflows"&&s()});function m(o){const g=r.value;if(g===void 0)throw new Error("scroll-area instance is missing");const v=Array.from(t.value.keys()),u=v.findIndex(y=>y===o);setTimeout(()=>{if(u<0)g.setScrollPercentage("vertical",1);else{const y=1*u/v.length*g.getScroll().verticalSize-50;g.setScrollPosition("vertical",y)}},100)}se(async()=>{n.watch(o=>[o.Root.eventWorkFlow],([o])=>{if(!o)return;const g=t.value.get(o.workFlowId);g!==void 0&&n.commit("notifySuccess",{message:`\u4EFB\u52A1\u7F16\u6392 ${g.title} \u5F53\u524D\u72B6\u6001: ${o.status}`}),s()}),F(()=>[t.value],()=>{const o=Number(a.params.workflowId);o!==0&&!isNaN(o)&&m(o)},{deep:!0})});const t=C(()=>n.state.WorkFlow.workflows);async function c(o,g){e.page=o,(await s()).length<e.pageSize?g(!0):g(!1)}const e=Ae({page:1,pageSize:5});async function s(){const[o]=await n.dispatch("WorkFlow/fetchWorkFlows",G({},e));return o}function h(o){return o.id===Number(a.params.workflowId||0)}function k(o){return o.state&&o.state.status==="running"}return(o,g)=>{const v=de("router-link");return x(),Q("div",tt,[b("div",lt,[i(M,{flat:"",loading:p(d),icon:"refresh",onClick:s},null,8,["loading"]),i(M,{flat:"",icon:"add",to:{name:"create_workflow"}})]),b("div",ot,[i(p(Le),{ref_key:"scrollArea",ref:r,visible:"","thumb-style":p(He),"bar-style":p(je),class:"tw-w-full tw-h-full tw-px-[15px]"},{default:f(()=>[i(p(Oe),{class:"tw-w-full tw-h-full",offset:100,onLoad:c},{default:f(()=>[i(ce,{class:"tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:f(()=>[(x(!0),Q(j,null,ue(p(t),([,u])=>(x(),A(v,{key:u.id,to:{name:"workflow",params:{workflowId:u.id}}},{default:f(()=>[b("div",{class:H((h(u)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[b("div",at,[b("div",st,[i(P,{name:"schedule",class:"tw-inline"}),B(" "+E(u.cronExpr),1)]),i(Ne),i(Ue,{outline:"",color:u.status===1?"green":"red",class:"tw-w-[50px]"},{default:f(()=>[B(E(k(u)?"\u6267\u884C\u4E2D":u.status==1?"\u8C03\u5EA6\u4E2D":"\u5DF2\u7EC8\u6B62"),1)]),_:2},1032,["color"])]),b("div",{class:H((h(u)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[i(P,{name:"numbers"}),B(" "+E(u.title),1)],2),b("div",nt,E(u.remark||"-"),1),b("div",rt,[b("div",ut,E(p(Me)(u.createTime*1e3)),1),i(et,{"workflow-id":u.id},null,8,["workflow-id"])])],2)]),_:2},1032,["to"]))),128))]),_:1})]),_:1})]),_:1},8,["thumb-style","bar-style"]),!p(d)&&(!p(t)||p(t).size===0)?(x(),Q("div",it,[i(P,{name:"outlet",style:{"font-size":"3rem"}}),dt])):$e("",!0)])])}}}),ft={class:"lg:q-pa-md tw-box-border tw-flex tw-flex-row tw-gap-4 tw-h-full tw-w-full"},wt={class:"tw-w-full tw-h-full tw-grow tw-overflow-hidden"},Nt=N({setup(l){const n=ie(),a=C(()=>n.name&&n.name.toString()!=="workflows"?"tw-hidden lg:tw-block":"");return(r,d)=>{const m=de("router-view");return x(),Q("div",ft,[b("div",{class:H("xl:tw-basis-1/5 lg:tw-basis-1/4  tw-h-full tw-w-full tw-shrink-0 "+p(a))},[i(ct)],2),b("div",wt,[i(m)])])}}});export{Nt as default};

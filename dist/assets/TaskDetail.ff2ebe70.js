var Qe=Object.defineProperty;var be=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var ye=(j,t,p)=>t in j?Qe(j,t,{enumerable:!0,configurable:!0,writable:!0,value:p}):j[t]=p,Fe=(j,t)=>{for(var p in t||(t={}))Re.call(t,p)&&ye(j,p,t[p]);if(be)for(var p of be(t))ze.call(t,p)&&ye(j,p,t[p]);return j};import{_ as Z,d as ee,c as V,u as te,r as F,o as H,w as ne,a as y,b as $,e as o,f as e,Q as ue,g as I,h as D,i as B,j as x,k as ie,l as Ee,m as Pe,n as G,C as re,p as Ne,q as Oe,s as a,t as de,v as Ve,x as me,y as Me,z as xe,A as Ye,B as pe,D as ce,E as fe,F as z,G as Ie,H as ve,I as _,J as _e,K as Te,L as De,M as Le,N as Ae,O as X,P as R,R as P,S as he,T as We,U as Be,V as O,W as $e,X as He,Y as Je,Z as Ke,$ as Ge,a0 as Xe,a1 as je,a2 as Ze,a3 as se,a4 as et,a5 as Ce}from"./index.8f86c916.js";import{u as tt}from"./index.1448257c.js";import{C as le}from"./Confirm.37580281.js";import{a as lt,f as ae}from"./datetime.561112b0.js";import{T as qe}from"./task.f3ffd066.js";import{J as Ue}from"./JSONViewer.205fd3a5.js";import{G as at}from"./log.9f8e5c4e.js";import{t as ut,b as ot}from"./thumbStyle.856de4cb.js";const st=B("div",{class:"text-h6"},"\u521B\u5EFA\u4EFB\u52A1",-1),rt=B("div",{class:"text-base"}," \u4E34\u65F6\u4EFB\u52A1\u540C\u6837\u4F1A\u4E0E\u6B63\u5F0F\u7684\u5B9A\u65F6\u4EFB\u52A1\u7ADE\u4E89\u76F8\u540C\u7684\u9501\uFF0C\u8BF7\u907F\u514D\u8C03\u5EA6\u51B2\u7A81(\u6307\u8FD0\u884C\u65F6\u95F4\u6709\u4EA4\u96C6) ",-1),nt={class:"tw-flex tw-gap-2 tw-justify-end tw-mb-2"},it={class:"row items-center justify-end"},dt={class:"row items-center justify-end"},mt=ee({props:{modelValue:{type:Boolean,default:!1},task:{type:Object,default:()=>({})}},emits:["update:modelValue","created"],setup(j,{emit:t}){const p=j,w=V({get:()=>p.modelValue,set:v=>{t("update:modelValue",v),l.value=""}}),C=V(()=>{const v=[{value:"",label:"\u968F\u673A"}],r=i.state.Project.projectClients.get(p.task.projectId);return r&&r.forEach((d,T,U)=>{const h=d.split(":")[0];v.push({value:h,label:h})}),v}),i=te(),n=F({taskId:p.task.id,projectId:p.task.projectId,command:p.task.command,remark:p.task.remark,noseize:p.task.noseize,scheduleTime:0,timeout:p.task.timeout,host:""}),l=F("");function A(v){l.value=lt(v*60,"YYYY-MM-DD HH:mm")}H(()=>{ne(()=>{w.value&&(n.value=Object.assign({},{taskId:p.task.id,projectId:p.task.projectId,command:p.task.command,remark:p.task.remark,noseize:p.task.noseize,scheduleTime:0,timeout:p.task.timeout,host:""}))})});const m=F(!1);async function b(){const v=n.value;if(!v.remark){i.commit("error",{error:{message:"\u4EFB\u52A1\u8BF4\u660E\u5FC5\u586B"}});return}if(!v.command){i.commit("error",{error:{message:"\u6267\u884C\u547D\u4EE4\u5FC5\u586B"}});return}m.value=!0;try{const r=await Ye({projectId:v.projectId,taskId:v.taskId,command:v.command,noseize:v.noseize,scheduleTime:Date.parse(l.value)/1e3,remark:v.remark,timeout:v.timeout,host:v.host});r.code!==0?i.commit("error",{error:{message:r.message}}):(i.commit("success",{message:"\u521B\u5EFA\u6210\u529F"}),w.value=!1,t("created"))}catch{}m.value=!1}return(v,r)=>(y(),$(xe,{modelValue:a(w),"onUpdate:modelValue":r[11]||(r[11]=d=>Me(w)?w.value=d:null),persistent:""},{default:o(()=>[e(me,{class:"tw-w-96 q-pa-sm"},{default:o(()=>[e(ue,null,{default:o(()=>[st,rt]),_:1}),e(ue,{style:{"max-height":"50vh"},class:"scroll"},{default:o(()=>[j.task?(y(),$(I,{key:"id","model-value":j.task.id,disable:"",label:"\u5173\u8054\u4EFB\u52A1 ID",square:"",filled:"",class:"tw-mb-4"},null,8,["model-value"])):D("v-if",!0),e(I,{key:"remark",modelValue:n.value.remark,"onUpdate:modelValue":r[0]||(r[0]=d=>n.value.remark=d),type:"textarea",label:"\u4EFB\u52A1\u8BF4\u660E *",autogrow:"",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),B("div",nt,[e(x,{dense:"",unelevated:"",class:"tw-text-xs tw-h-6",color:"warning","text-color":"black",label:"\u4E00\u5206\u949F\u540E",onClick:r[1]||(r[1]=d=>A(1))}),e(x,{dense:"",unelevated:"",class:"tw-text-xs tw-h-6",color:"warning","text-color":"black",label:"\u4E94\u5206\u949F\u540E",onClick:r[2]||(r[2]=d=>A(5))}),e(x,{dense:"",unelevated:"",class:"tw-text-xs tw-h-6",color:"warning","text-color":"black",label:"\u4E00\u5C0F\u65F6\u540E",onClick:r[3]||(r[3]=d=>A(60))})]),e(I,{modelValue:l.value,"onUpdate:modelValue":r[6]||(r[6]=d=>l.value=d),filled:"",square:"",label:"\u8C03\u5EA6\u65F6\u95F4 *",class:"tw-mb-4"},{prepend:o(()=>[e(ie,{name:"event",class:"cursor-pointer"},{default:o(()=>[e(Ee,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[e(Pe,{modelValue:l.value,"onUpdate:modelValue":r[4]||(r[4]=d=>l.value=d),"text-color":"black",mask:"YYYY-MM-DD HH:mm"},{default:o(()=>[B("div",it,[G(e(x,{label:"\u5173\u95ED",color:"primary",flat:""},null,512),[[re,!0]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),append:o(()=>[e(ie,{name:"access_time",class:"cursor-pointer"},{default:o(()=>[e(Ee,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[e(Ne,{modelValue:l.value,"onUpdate:modelValue":r[5]||(r[5]=d=>l.value=d),mask:"YYYY-MM-DD HH:mm","text-color":"black",format24h:""},{default:o(()=>[B("div",dt,[G(e(x,{label:"\u5173\u95ED",color:"primary",flat:""},null,512),[[re,!0]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(I,{key:"timeout",modelValue:n.value.timeout,"onUpdate:modelValue":r[7]||(r[7]=d=>n.value.timeout=d),modelModifiers:{number:!0},type:"number",label:"\u8D85\u65F6\u65F6\u95F4 * (\u5355\u4F4D:\u79D2 s)",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(I,{key:"command",modelValue:n.value.command,"onUpdate:modelValue":r[8]||(r[8]=d=>n.value.command=d),placeholder:'echo "hello word"',type:"textarea",label:"\u6267\u884C\u6307\u4EE4 *",autogrow:"",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(Oe,{modelValue:n.value.host,"onUpdate:modelValue":r[9]||(r[9]=d=>n.value.host=d),"emit-value":"","map-options":"",autogrow:"",square:"",filled:"",label:"\u6267\u884C\u8282\u70B9",options:a(C),class:"tw-mb-4"},null,8,["modelValue","options"]),e(de,{key:"noseize",modelValue:n.value.noseize,"onUpdate:modelValue":r[10]||(r[10]=d=>n.value.noseize=d),"false-value":0,"true-value":1,label:"\u5E76\u884C\u8C03\u5EA6",class:"tw-mb-4"},null,8,["modelValue"])]),_:1}),e(Ve,{align:"right",class:"tw-flex tw-gap-2 tw-flex-col-reverse lg:tw-flex-row lg:tw-justify-end"},{default:o(()=>[G(e(x,{flat:"",label:"\u53D6\u6D88",class:"lg:tw-w-24 tw-w-full"},null,512),[[re,!0]]),e(x,{color:"primary","text-color":"black",label:"\u521B\u5EFA",class:"lg:tw-w-24 tw-w-full",loading:m.value,onClick:b},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});var Se=Z(mt,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/DialogTemporaryTaskForm.vue"]]);const ct={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},pt={key:0,class:"tw-flex tw-flex-row-reverse tw-pb-3 tw-flex-wrap tw-gap-2"},ft=_("\u7ED3\u675F\u8FDB\u7A0B"),vt=_("\u7ACB\u5373\u6267\u884C"),wt=_("\u4E34\u65F6\u8C03\u5EA6 "),kt=_(" \u6307\u5B9A\u65F6\u95F4\u8C03\u5EA6\u4E00\u6B21\u7684\u4EFB\u52A1 "),gt=_("\u590D\u5236\u4EFB\u52A1 "),bt=_(" \u4EE5\u5F53\u524D\u4EFB\u52A1\u5185\u5BB9\u4E3A\u57FA\u7840\u8FDB\u884C\u65B0\u4EFB\u52A1\u7684\u521B\u5EFA "),yt={class:"q-pa-sm"},Ft=ee({props:{id:{type:String,default:""},projectId:{type:Number,required:!0}},setup(j){const t=j;function p(){U.push({name:"temporary_tasks",params:{projectId:t.projectId}})}const w=V(()=>({id:"",name:"",projectId:t.projectId,command:"",cronExpr:"0 0 0 * * * *",remark:"",timeout:300,createTime:0,status:0,isRunning:-1,noseize:0,exclusion:0,clientIp:"",tmpId:""}));function C(c,s){return!c||!s?!1:c.name===s.name&&c.cronExpr===s.cronExpr&&c.remark===s.remark&&c.timeout===s.timeout&&c.status===s.status&&c.noseize===s.noseize&&c.command===s.command}const i=te(),n=pe(),l=V(()=>{var c;return(c=i.state.Task.tasks.get(t.projectId))==null?void 0:c.find(s=>s.id===t.id||s.id===n.query.copyid)}),A=V(()=>i.state.Project.projects.find(c=>c.id===t.projectId)),m=F(Object.assign({},l.value||w.value)),b=V(()=>n.name&&n.name.toString()==="create_crontab_task");b.value&&(m.value.id="",m.value.isRunning=-1),ce(()=>t.id,(c,s)=>{var Q;(t.id!==((Q=l.value)==null?void 0:Q.id)||!b.value&&m.value.id===""||m.value.id!==l.value.id)&&(m.value=Object.assign({},l.value||w.value)),m.value.isRunning=-1});const v=V(()=>{var c;return((c=l.value)==null?void 0:c.isRunning)===1?!1:!C(l.value,m.value)}),r=V(()=>{const{name:c,command:s,timeout:Q,cronExpr:K}=m.value;return c!==""&&s!==""&&Q>0&&K!==""}),d=V(()=>{const{name:c,command:s,timeout:Q,cronExpr:K}=m.value;return c===""?"\u4EFB\u52A1\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A":s===""?"\u6267\u884C\u6307\u4EE4\u4E0D\u80FD\u4E3A\u7A7A":Q<=0?"\u8D85\u65F6\u65F6\u95F4\u672A\u6307\u5B9A":K===""?"\u8C03\u5EA6\u8BA1\u5212\u672A\u6307\u5B9A":""});async function T(){await i.dispatch("Task/fetchTasks",{projectId:t.projectId})}const U=fe(),h=F(!1);async function N(){if(i.commit("cleanError"),!r.value){i.commit("error",{error:{message:d.value}});return}h.value=!0,b.value&&(m.value.id="");const c=await i.dispatch("saveTask",{task:JSON.parse(JSON.stringify(m.value))});if(b.value){const s=t.projectId;await T(),U.push({name:"crontab_task",params:{projectId:s,taskId:c.id}})}h.value=!1}function M(){m.value=Object.assign({},l.value||w.value)}const q=F(!1),g=F(!1);async function k(c,s){i.commit("cleanError"),g.value=!0,console.log("delete loading",g.value);try{await i.dispatch("deleteTask",{projectId:c,taskId:s}),i.state.Root.currentError===void 0&&(await T(),U.push({name:"crontab_tasks",params:{projectId:n.params.projectId}}),q.value=!1)}catch(Q){console.error(Q),i.commit("error",{error:Q})}g.value=!1}const u=F(!1),f=F(!1);async function Y(c,s){f.value=!1,u.value=!0;try{await _e(i.getters.apiv1,c,s)}catch{u.value=!1}}H(()=>{i.watch(c=>[c.Root.eventTask],([c])=>{!c||c.projectId!==t.projectId||c.taskId!==t.id||qe.isFinished(c.status)&&(u.value=!1)})});const L=F(!1),W=F(!1),oe=async()=>{W.value=!1,L.value=!0;try{await Te({projectId:t.projectId,taskId:t.id}),await T(),m.value.status=0}catch(c){console.error(c),i.commit("error",{error:c})}L.value=!1},J=F(!1);function S(){var c;U.push({name:"create_crontab_task",query:{copyid:(c=l.value)==null?void 0:c.id}})}return(c,s)=>{var Q,K,we,ke,ge;return y(),z("div",ct,[e(Se,{modelValue:J.value,"onUpdate:modelValue":s[0]||(s[0]=E=>J.value=E),task:a(l),onCreated:p},null,8,["modelValue","task"]),e(le,{modelValue:q.value,"onUpdate:modelValue":s[1]||(s[1]=E=>q.value=E),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1"+((Q=a(l))==null?void 0:Q.name)+"?",type:"warning",loading:g.value,onConfirm:s[2]||(s[2]=E=>a(A)&&a(l)&&k(a(A).id,a(l).id))},null,8,["modelValue","content","loading"]),e(le,{modelValue:W.value,"onUpdate:modelValue":s[3]||(s[3]=E=>W.value=E),content:"\u786E\u5B9A\u8981\u7ED3\u675F\u8FDB\u7A0B\u5417\uFF1F\u5F3A\u5236\u7ED3\u675F\u540E\u4EFB\u52A1\u7684\u542F\u7528\u72B6\u6001\u4F1A\u81EA\u52A8\u53D8\u66F4\u4E3A\u505C\u7528\u72B6\u6001\u3002",type:"warning",onConfirm:oe},null,8,["modelValue"]),e(le,{modelValue:f.value,"onUpdate:modelValue":s[4]||(s[4]=E=>f.value=E),content:"\u786E\u5B9A\u8981\u7ACB\u5373\u6267\u884C\u5417\uFF1F",onConfirm:s[5]||(s[5]=E=>a(l)&&Y(j.projectId,a(l).id))},null,8,["modelValue"]),a(b)?D("v-if",!0):(y(),z("div",pt,[e(x,{flat:"",dense:"",class:"tw-w-24 tw-text-red-300 lg:tw-hidden",icon:"delete",onClick:s[6]||(s[6]=E=>q.value=!0)}),((K=a(l))==null?void 0:K.isRunning)===1?(y(),$(x,{key:0,flat:"","text-color":"red",disable:((we=a(l))==null?void 0:we.isRunning)!==1,class:"tw-w-24 tw-ml-1",loading:L.value,onClick:s[7]||(s[7]=E=>W.value=!0)},{default:o(()=>[ft]),_:1},8,["disable","loading"])):D("v-if",!0),e(x,{color:"primary","text-color":"black",disable:a(v)||((ke=a(l))==null?void 0:ke.isRunning)===1,class:"tw-w-24",loading:u.value||((ge=a(l))==null?void 0:ge.isRunning)===1,onClick:s[8]||(s[8]=E=>f.value=!0)},{default:o(()=>[vt]),_:1},8,["disable","loading"]),e(x,{color:"warning","text-color":"black",class:"tw-w-24 tw-opacity-90",onClick:s[9]||(s[9]=E=>J.value=!0)},{default:o(()=>[wt,e(Ie,{class:"bg-warning tw-text-black",offset:[10,10]},{default:o(()=>[kt]),_:1})]),_:1}),e(x,{outline:"",class:"tw-w-24 tw-opacity-90",onClick:S},{default:o(()=>[gt,e(Ie,{class:"bg-warning tw-text-black",offset:[10,10]},{default:o(()=>[bt]),_:1})]),_:1})])),e(ve,{class:"tw-w-full",onSubmit:N,onReset:M},{default:o(()=>[a(l)&&!a(b)?(y(),$(I,{key:"id","model-value":a(l).id,disable:"",label:"\u4EFB\u52A1 ID",square:"",filled:"",class:"tw-mb-4"},null,8,["model-value"])):D("v-if",!0),e(I,{key:"project","model-value":a(A)?a(A).title:"",disable:"",label:"\u6240\u5C5E\u9879\u76EE",square:"",filled:"",class:"tw-mb-4"},null,8,["model-value"]),e(I,{key:"name",modelValue:m.value.name,"onUpdate:modelValue":s[10]||(s[10]=E=>m.value.name=E),label:"\u4EFB\u52A1\u540D\u79F0",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(I,{key:"cron",modelValue:m.value.cronExpr,"onUpdate:modelValue":s[11]||(s[11]=E=>m.value.cronExpr=E),label:"\u8C03\u5EA6\u8BA1\u5212 (*\u79D2 *\u5206 *\u65F6 *\u65E5 *\u6708 *\u5468 *\u5E74)",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(I,{key:"timeout",modelValue:m.value.timeout,"onUpdate:modelValue":s[12]||(s[12]=E=>m.value.timeout=E),modelModifiers:{number:!0},type:"number",label:"\u8D85\u65F6\u65F6\u95F4 (\u5355\u4F4D:\u79D2 s)",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(I,{key:"command",modelValue:m.value.command,"onUpdate:modelValue":s[13]||(s[13]=E=>m.value.command=E),placeholder:'echo "hello word"',type:"textarea",label:"\u6267\u884C\u6307\u4EE4",autogrow:"",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(I,{key:"remark",modelValue:m.value.remark,"onUpdate:modelValue":s[14]||(s[14]=E=>m.value.remark=E),type:"textarea",label:"\u4EFB\u52A1\u5907\u6CE8",autogrow:"",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(de,{key:"noseize",modelValue:m.value.noseize,"onUpdate:modelValue":s[15]||(s[15]=E=>m.value.noseize=E),"false-value":0,"true-value":1,label:"\u5E76\u884C\u8C03\u5EA6",class:"tw-mb-4"},null,8,["modelValue"]),e(de,{key:"status",modelValue:m.value.status,"onUpdate:modelValue":s[16]||(s[16]=E=>m.value.status=E),"false-value":0,"true-value":1,label:"\u662F\u5426\u542F\u7528",class:"tw-mb-4"},null,8,["modelValue"]),B("div",yt,[e(x,{color:"primary","text-color":"black",type:"submit",label:a(b)?"\u521B\u5EFA":"\u4FDD\u5B58",disable:!a(v),loading:h.value,class:"lg:tw-w-24 tw-w-full lg:tw-mr-4 lg:tw-mb-0 tw-mb-4"},null,8,["label","disable","loading"]),e(x,{color:"primary",type:"reset",label:"\u91CD\u7F6E",flat:"",disable:!a(v),class:"lg:tw-w-24 tw-w-full"},null,8,["disable"])])]),_:1})])}}});var Et=Z(Ft,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/TaskDetail.vue"]]);const It=_("\u8282\u70B9 IP"),jt=_("\u5F00\u59CB\u65F6\u95F4"),Ct=_("\u7ED3\u675F\u65F6\u95F4"),Vt=ee({props:{id:{type:String,required:!0},projectId:{type:Number,required:!0}},emits:["onpage"],setup(j,{emit:t}){const p=j,w=te(),C=V(()=>w.state.Root.taskLogs),i=V(()=>w.state.Root.taskLogsTotal),n=V(()=>w.state.Root.loadingTaskLogs),l=F({sortBy:"",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),A=F();H(()=>{De(()=>{var b;(b=A.value)==null||b.$el.querySelector("table.q-table").classList.add("tw-table-fixed")})});function m({pagination:{page:b,rowsPerPage:v}}){const r=l.value;r.page=b,r.rowsPerPage=v,t("onpage")}return ne(()=>{const b=l.value;b.rowsNumber=i.value}),H(async()=>{ne(async()=>{const b=l.value;await w.dispatch("fetchTaskLogs",{projectId:p.projectId,taskId:p.id,page:b.page,pageSize:b.rowsPerPage})})}),(b,v)=>(y(),$(a(We),{ref_key:"logTable",ref:A,pagination:l.value,"onUpdate:pagination":v[0]||(v[0]=r=>l.value=r),class:"tw-w-full tw-h-full tw-bg-[#121212]","rows-per-page-options":[5,10,15],rows:a(C),loading:a(n),"row-key":"id",color:"primary",flat:"","hide-header":"",onRequest:m},{loading:o(()=>[e(Le,{showing:"",color:"primary"})]),body:o(r=>[e(me,{class:"tw-my-4 tw-x-full",flat:"",bordered:""},{default:o(()=>[e(Ae,null,{default:o(()=>[e(X,null,{default:o(()=>[e(R,{overline:""},{default:o(()=>[It]),_:1}),e(R,null,{default:o(()=>[_(P(r.row.clientIp),1)]),_:2},1024)]),_:2},1024),e(X,null,{default:o(()=>[e(R,{overline:""},{default:o(()=>[jt]),_:1}),e(R,null,{default:o(()=>[_(P(a(ae)(r.row.startTime*1e3)),1)]),_:2},1024)]),_:2},1024),e(X,null,{default:o(()=>[e(R,{overline:""},{default:o(()=>[Ct]),_:1}),e(R,null,{default:o(()=>[_(P(a(ae)(r.row.endTime*1e3)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(he),e(ue,{class:"tw-w-full tw-overflow-x-auto"},{default:o(()=>[e(Ue,{json:r.row.result},null,8,["json"])]),_:2},1024)]),_:2},1024)]),_:1},8,["pagination","rows","loading"]))}});var xt=Z(Vt,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/TaskLogs.vue"]]);const _t=_("\u8282\u70B9 IP"),Tt=_("\u5F00\u59CB\u65F6\u95F4"),Dt=_("\u7ED3\u675F\u65F6\u95F4"),At={key:1,class:"tw-flex tw-flex-row-reverse tw-pb-3 tw-flex-wrap tw-gap-2"},ht={key:2,class:"tw-flex tw-flex-row-reverse tw-pb-3 tw-flex-wrap tw-gap-2"},Bt=_("\u5220\u9664\u4EFB\u52A1"),$t=_("\u7ED3\u675F\u8FDB\u7A0B"),qt=_("\u590D\u5236\u4EFB\u52A1"),Ut={key:3},St=ee({props:{id:{type:Number,default:0,required:!0},projectId:{type:Number,required:!0}},setup(j){const t=j,p=F(!1),w=F();function C(u){w.value={id:u.taskId,projectId:u.projectId,remark:u.remark,command:u.command,timeout:u.timeout,cronExpr:"",createTime:0,name:"",status:0,isRunning:0,noseize:0,exclusion:0,clientIp:"",tmpId:""}}const i=F(),n=te(),l=F();function A(){var u;l.value=(u=n.state.Task.temporaryTasks.get(t.projectId))==null?void 0:u.find(f=>f.id===Number(t.id))}ce(()=>t.id,(u,f)=>{console.log("watched",u,f),A()}),ce(l,(u,f)=>{console.log("watched task",u,f),(!i.value||(u==null?void 0:u.tmpId)!==(f==null?void 0:f.tmpId))&&k()});function m(){l.value?(C(l.value),p.value=!0):console.error("failed to copy task, the task is not found")}const b=V(()=>n.state.Project.projects.find(u=>u.id===t.projectId));async function v(){try{await n.dispatch("Task/fetchTemporaryTasks",{projectId:t.projectId})}catch(u){console.error("failed to dispatch fetchTemporaryTasks",u)}}H(()=>{n.watch(u=>[u.Root.eventTask],async([u])=>{var f;!u||u.projectId!==t.projectId||u.tmpId!==((f=l.value)==null?void 0:f.tmpId)||!i.value&&qe.isFinished(u.status)&&k()}),A()});const r=F(!1),d=F(!1),T=async()=>{if(!!l.value){d.value=!1,r.value=!0;try{await Te({projectId:t.projectId,taskId:l.value.taskId}),await v()}catch(u){console.log(u)}r.value=!1}},U=F(!1),h=F(!1),N=fe(),M=async()=>{h.value=!1,U.value=!0;try{await He(Number(t.id)),await v(),N.back()}catch(u){console.log(u)}U.value=!1},q=F(!0);function g(u=500){let f=!1,Y=!1;return q.value=!0,setTimeout(()=>{Y=!0,f&&(q.value=!1)},u),()=>{f=!0,Y&&(q.value=!1)}}async function k(){if(!l.value)return;const u=g(500);i.value=null;try{i.value=await at({taskId:l.value.taskId,projectId:l.value.projectId,tmpId:l.value.tmpId})}catch(f){console.error(f)}u()}return(u,f)=>{var Y,L,W,oe,J;return y(),z($e,null,[e(Se,{modelValue:p.value,"onUpdate:modelValue":f[0]||(f[0]=S=>p.value=S),task:w.value,onCreated:v},null,8,["modelValue","task"]),e(le,{modelValue:d.value,"onUpdate:modelValue":f[1]||(f[1]=S=>d.value=S),content:"\u786E\u5B9A\u8981\u7ED3\u675F\u8FDB\u7A0B\u5417\uFF1F",type:"warning",onConfirm:T},null,8,["modelValue"]),e(le,{modelValue:h.value,"onUpdate:modelValue":f[2]||(f[2]=S=>h.value=S),content:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u4E34\u65F6\u4EFB\u52A1\u5417\uFF1F",type:"warning",onConfirm:M},null,8,["modelValue"]),G(e(O,{type:"QInput",class:"tw-h-52 tw-mb-4",animation:"fade"},null,512),[[Be,q.value]]),!q.value&&i.value?(y(),$(me,{key:0,class:"tw-mb-4",flat:"",bordered:""},{default:o(()=>[e(Ae,null,{default:o(()=>[e(X,null,{default:o(()=>[e(R,{overline:""},{default:o(()=>[_t]),_:1}),e(R,null,{default:o(()=>[_(P(i.value.clientIp),1)]),_:1})]),_:1}),e(X,null,{default:o(()=>[e(R,{overline:""},{default:o(()=>[Tt]),_:1}),e(R,null,{default:o(()=>[_(P(a(ae)(i.value.startTime*1e3)),1)]),_:1})]),_:1}),e(X,null,{default:o(()=>[e(R,{overline:""},{default:o(()=>[Dt]),_:1}),e(R,null,{default:o(()=>[_(P(a(ae)(i.value.endTime*1e3)),1)]),_:1})]),_:1})]),_:1}),e(he),e(ue,{class:"tw-w-full tw-overflow-x-auto"},{default:o(()=>[e(Ue,{json:i.value.result},null,8,["json"])]),_:1})]),_:1})):D("v-if",!0),q.value?(y(),z("div",At,[e(O,{type:"QBtn",animation:"fade"})])):D("v-if",!0),q.value?D("v-if",!0):(y(),z("div",ht,[(Y=l.value)!=null&&Y.isRunning?(y(),$(x,{key:0,loading:!0})):D("v-if",!0),((L=l.value)==null?void 0:L.isRunning)!==1&&!((W=i.value)!=null&&W.result)?(y(),$(x,{key:1,"text-color":"red",outline:"",class:"tw-w-24 tw-ml-1",loading:U.value,onClick:f[3]||(f[3]=S=>h.value=!0)},{default:o(()=>[Bt]),_:1},8,["loading"])):D("v-if",!0),((oe=l.value)==null?void 0:oe.isRunning)===1?(y(),$(x,{key:2,outline:"","text-color":"red",disable:((J=l.value)==null?void 0:J.isRunning)!==1,class:"tw-w-24 tw-ml-1",loading:r.value,onClick:f[4]||(f[4]=S=>d.value=!0)},{default:o(()=>[$t]),_:1},8,["disable","loading"])):D("v-if",!0),e(x,{outline:"",class:"tw-w-24 tw-ml-1",onClick:m},{default:o(()=>[qt]),_:1})])),q.value?(y(),z("div",Ut,[e(O,{type:"QInput",class:"tw-mb-4",square:"",animation:"fade"}),e(O,{type:"QInput",class:"tw-mb-4",square:"",animation:"fade"}),e(O,{type:"QInput",class:"tw-mb-4",square:"",animation:"fade"}),e(O,{type:"QInput",class:"tw-mb-4",square:"",animation:"fade"}),e(O,{type:"QInput",class:"tw-mb-4",square:"",animation:"fade"}),e(O,{type:"QInput",class:"tw-mb-4",square:"",animation:"fade"}),e(O,{type:"QInput",class:"tw-mb-4",square:"",animation:"fade"})])):D("v-if",!0),!q.value&&l.value?(y(),$(ve,{key:4,class:"tw-w-full"},{default:o(()=>[l.value?(y(),$(I,{key:"id","model-value":l.value.taskId+" - "+l.value.tmpId,disable:"",label:"\u4EFB\u52A1 ID\uFF08task_id - tmp_id\uFF09",square:"",filled:"",class:"tw-mb-4"},null,8,["model-value"])):D("v-if",!0),e(I,{key:"project","model-value":a(b)?a(b).title:"",disable:"",label:"\u6240\u5C5E\u9879\u76EE",square:"",filled:"",class:"tw-mb-4"},null,8,["model-value"]),e(I,{key:"remark",modelValue:l.value.remark,"onUpdate:modelValue":f[5]||(f[5]=S=>l.value.remark=S),type:"textarea",label:"\u4EFB\u52A1\u5907\u6CE8",autogrow:"",disable:"",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(I,{key:"cron","model-value":a(ae)(l.value.scheduleTime*1e3,"YYYY-MM-DD HH:mm"),label:"\u8C03\u5EA6\u65F6\u95F4",square:"",disable:"",filled:"",class:"tw-mb-4"},null,8,["model-value"]),e(I,{key:"timeout",modelValue:l.value.timeout,"onUpdate:modelValue":f[6]||(f[6]=S=>l.value.timeout=S),modelModifiers:{number:!0},type:"number",label:"\u8D85\u65F6\u65F6\u95F4 (\u5355\u4F4D:\u79D2 s)",square:"",disable:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(I,{key:"command",modelValue:l.value.command,"onUpdate:modelValue":f[7]||(f[7]=S=>l.value.command=S),placeholder:'echo "hello word"',type:"textarea",label:"\u6267\u884C\u6307\u4EE4",autogrow:"",disable:"",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(I,{key:"noseize","model-value":l.value.noseize===1?"\u662F":"\u5426",type:"textarea",label:"\u5E76\u884C\u8C03\u5EA6",autogrow:"",disable:"",square:"",filled:"",class:"tw-mb-4"},null,8,["model-value"])]),_:1})):D("v-if",!0)],64)}}});var Qt=Z(St,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/TemporaryTaskDetail.vue"]]);const Rt={class:"q-ml-sm"},zt={key:0,class:"tw-flex tw-flex-row-reverse tw-pb-3 tw-flex-wrap tw-gap-1"},Pt=_(" \u6267\u884C "),Nt={class:"q-pa-sm"},Ot=ee({props:{id:{type:String,default:""},projectId:{type:Number,required:!0}},setup(j){const t=j,p=V(()=>({id:"",name:"",projectId:t.projectId,command:"",remark:"",timeout:300,createTime:0,noseize:0})),w=te(),C=V(()=>{var g;return(g=w.state.WorkFlowTask.tasks.get(t.projectId))==null?void 0:g.find(k=>k.id===t.id)}),i=V(()=>w.state.Project.projects.find(g=>g.id===t.projectId)),n=F(Object.assign({},C.value||p.value));ne(()=>{n.value=Object.assign({},C.value||p.value)});const l=V(()=>JSON.stringify(C.value)!==JSON.stringify(n.value)),A=V(()=>{const{name:g,command:k,timeout:u}=n.value;return g!==""&&k!==""&&u>0}),m=V(()=>{const{name:g,command:k,timeout:u}=n.value;return g===""?"\u4EFB\u52A1\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A":k===""?"\u6267\u884C\u6307\u4EE4\u4E0D\u80FD\u4E3A\u7A7A":u<=0?"\u8D85\u65F6\u65F6\u95F4\u672A\u6307\u5B9A":""}),b=fe(),v=F(!1);async function r(){v.value=!0;try{if(w.commit("cleanError"),!A.value){w.commit("error",{error:{message:m.value}});return}if(await w.dispatch("saveWorkFlowTask",{task:n.value}),await w.dispatch("WorkFlowTask/fetchTasks",{projectId:t.projectId}),N.value){const g=Object.assign([],w.state.WorkFlowTask.tasks.get(t.projectId)||[]);g.sort((u,f)=>u.createTime-f.createTime);const k=g[g.length-1];b.push({name:"workflow_task",params:{projectId:t.projectId,taskId:k.id}})}}catch(g){console.error(g),w.commit("error",{error:g})}v.value=!1}function d(){n.value=Object.assign({},C.value||p.value)}const T=F(!1);async function U(g,k){w.commit("cleanError"),await w.dispatch("deleteWorkFlowTask",{projectId:g,taskId:k}),w.state.Root.currentError===void 0&&(w.dispatch("WorkFlowTask/fetchTasks",Fe({},t)),b.push({name:"workflow_tasks"}),T.value=!1)}const h=pe(),N=V(()=>h.name&&h.name.toString()==="create_workflow_task"),M=F(!1);async function q(g,k){M.value=!0;try{await _e(w.getters.apiv1,g,k)}finally{M.value=!1}}return H(()=>{w.watch(g=>[g.Root.eventWorkFlowTask],([g])=>{!g||g.projectId!==t.projectId||g.taskId!==t.id||w.dispatch("WorkFlowTask/fetchTasks",{projectId:t.projectId})})}),(g,k)=>(y(),z($e,null,[e(xe,{modelValue:T.value,"onUpdate:modelValue":k[1]||(k[1]=u=>T.value=u)},{default:o(()=>[e(me,null,{default:o(()=>[e(ue,{class:"row items-center"},{default:o(()=>{var u;return[e(Je,{icon:"delete",color:"primary","text-color":"white"}),B("span",Rt," \u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1 "+P((u=a(C))==null?void 0:u.name),1)]}),_:1}),e(Ve,{align:"right"},{default:o(()=>[G(e(x,{flat:"",label:"\u53D6\u6D88",color:"primary"},null,512),[[re,!0]]),e(x,{flat:"",label:"\u5220\u9664",color:"red",onClick:k[0]||(k[0]=()=>a(i)&&a(C)&&U(a(i).id,a(C).id))})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(N)?D("v-if",!0):(y(),z("div",zt,[e(x,{flat:"",class:"tw-w-24 tw-text-red-300 lg:tw-hidden",icon:"delete",onClick:k[2]||(k[2]=u=>T.value=!0)}),e(x,{color:"primary","text-color":"black",disable:a(l),class:"tw-w-24",loading:M.value,onClick:k[3]||(k[3]=()=>a(C)&&q(j.projectId,a(C).id))},{default:o(()=>[Pt]),_:1},8,["disable","loading"])])),e(ve,{class:"tw-w-full",onSubmit:r,onReset:d},{default:o(()=>[a(C)?(y(),$(I,{key:"id","model-value":a(C).id,disable:"",label:"\u4EFB\u52A1 ID",square:"",filled:"",class:"tw-mb-4"},null,8,["model-value"])):D("v-if",!0),e(I,{key:"project","model-value":a(i)?a(i).title:"",disable:"",label:"\u6240\u5C5E\u9879\u76EE",square:"",filled:"",class:"tw-mb-4"},null,8,["model-value"]),e(I,{key:"name",modelValue:n.value.name,"onUpdate:modelValue":k[4]||(k[4]=u=>n.value.name=u),label:"\u4EFB\u52A1\u540D\u79F0",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(I,{key:"timeout",modelValue:n.value.timeout,"onUpdate:modelValue":k[5]||(k[5]=u=>n.value.timeout=u),modelModifiers:{number:!0},type:"number",label:"\u8D85\u65F6\u65F6\u95F4 (\u5355\u4F4D:\u79D2 s)",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(I,{key:"command",modelValue:n.value.command,"onUpdate:modelValue":k[6]||(k[6]=u=>n.value.command=u),type:"textarea",placeholder:'echo "hello word"',label:"\u6267\u884C\u6307\u4EE4",autogrow:"",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(I,{key:"remark",modelValue:n.value.remark,"onUpdate:modelValue":k[7]||(k[7]=u=>n.value.remark=u),type:"textarea",label:"\u4EFB\u52A1\u5907\u6CE8",autogrow:"",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),e(de,{key:"noseize",modelValue:n.value.noseize,"onUpdate:modelValue":k[8]||(k[8]=u=>n.value.noseize=u),"false-value":0,"true-value":1,label:"\u5E76\u884C\u8C03\u5EA6",class:"tw-mb-4"},null,8,["modelValue"]),B("div",Nt,[e(x,{color:"primary","text-color":"black",type:"submit",label:"\u4FDD\u5B58",loading:v.value,disable:!a(l),class:"lg:tw-w-24 tw-w-full lg:tw-mr-4 lg:tw-mb-0 tw-mb-4"},null,8,["loading","disable"]),e(x,{color:"primary",type:"reset",label:"\u91CD\u7F6E",flat:"",disable:!a(l),class:"lg:tw-w-24 tw-w-full"},null,8,["disable"])])]),_:1})],64))}});var Mt=Z(Ot,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/WorkFlowTaskDetail.vue"]]);const Yt={class:"tw-px-4 tw-pt-2 tw-w-full tw-h-full tw-flex tw-flex-col"},Lt={class:"tw-text-[#7e7e7e] tw-mb-4"},Wt={class:"tw-flex tw-items-center tw-justify-start tw-gap-4 tw-text-lg tw-mb-4"},Ht={key:0,class:"tw-pb-4"},Jt={class:"tw-flex tw-gap-2 tw-items-center"},Kt=_(" \u5728\u7EBF\u8282\u70B9: "),Gt={class:"tw-flex tw-w-full tw-grow"},Xt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Zt={key:0,class:"tw-hidden lg:tw-block"},el=ee({props:{id:{type:String,default:""},projectId:{type:Number,required:!0},type:{type:String,default:"crontab"}},setup(j){const t=j,p=Ke();function w(){let T="empty";d.value&&d.value.length>0&&(T=d.value.join("</br>")),p.dialog({title:"\u5728\u7EBF\u8282\u70B9",message:T,html:!0,color:"primary"})}const C=te(),i=V(()=>C.state.Project.projects.find(T=>T.id===t.projectId)),n=pe(),l=F(),A=()=>{De(()=>{var T;(T=l.value)==null||T.setScrollPosition("vertical",0)})},m=V(()=>n.name&&n.name.toString()===`create_${t.type}_task`),b=V(()=>{var T;if(m.value)return"detail";if(n.name){const U=n.name.toString();if(U===`${t.type}_task_logs`)return"logs";if(U===`${t.type}_task`)return"detail"}throw new Error(`Unknown route name ${(T=n.name)==null?void 0:T.toString()}`)}),{width:v}=tt();async function r(){await C.dispatch("Project/fetchProjectClients",{projectId:t.projectId})}H(()=>{r()}),Ge(()=>{C.commit("Project/setProjectClients",{clients:[]})});const d=V(()=>C.state.Project.projectClients.get(t.projectId));return(T,U)=>{var h,N;return y(),z("div",Yt,[B("div",Lt,[B("div",Wt,[B("span",null,[e(ie,{name:"folder"}),_(" "+P((h=a(i))==null?void 0:h.title),1)]),B("span",null," ID: "+P(j.projectId),1)]),a(i)&&a(i).remark.trim()!==""?(y(),z("div",Ht,P(a(i).remark),1)):D("v-if",!0),B("div",Jt,[e(ie,{name:"hive"}),Kt,B("span",{class:Xe(["tw-font-extrabold",{"tw-text-primary":a(d)&&a(d).length>0,"tw-text-red-500":!a(d)||a(d).length===0}])},P(((N=a(d))==null?void 0:N.length)||0),3),G(B("span",{class:"tw-text-white tw-cursor-pointer",onClick:w},"\u67E5\u770B\u8282\u70B9",512),[[Be,a(d)&&a(d).length>0]])])]),a(m)?D("v-if",!0):(y(),$(je,{key:0,"model-value":a(b),"active-color":"primary",align:"left",class:"lg:tw-hidden tw-display"},{default:o(()=>[e(se,{name:"detail",label:"\u8BE6\u60C5",to:{name:`${t.type}_task`,params:{taskId:t.id}},replace:""},null,8,["to"]),e(se,{name:"logs",label:"\u65E5\u5FD7",to:{name:`${t.type}_task_logs`,params:{taskId:t.id}},replace:""},null,8,["to"])]),_:1},8,["model-value"])),B("div",Gt,[B("div",Xt,[e(a(Ze),{ref_key:"scroll",ref:l,class:"tw-grow","thumb-style":a(ut),"bar-style":a(ot)},{default:o(()=>[e(et,{"model-value":a(b),animated:"",vertical:a(v)>=1024,class:"tw-w-full tw-h-full tw-bg-[#121212] tw-p-0 lg:tw-pr-4"},{default:o(()=>[e(Ce,{name:"detail",class:"tw-px-0"},{default:o(()=>[t.type==="crontab"?(y(),$(Et,{key:0,id:t.id,"project-id":t.projectId},null,8,["id","project-id"])):t.type==="workflow"?(y(),$(Mt,{key:1,id:t.id,"project-id":t.projectId},null,8,["id","project-id"])):D("v-if",!0),t.type==="temporary"?(y(),$(Qt,{key:2,id:Number(t.id),"project-id":t.projectId},null,8,["id","project-id"])):D("v-if",!0)]),_:1}),e(Ce,{name:"logs",class:"tw-px-0"},{default:o(()=>[e(xt,{id:t.id,"project-id":t.projectId,onOnpage:A},null,8,["id","project-id"])]),_:1})]),_:1},8,["model-value","vertical"])]),_:1},8,["thumb-style","bar-style"])]),t.type!="temporary"?(y(),z("div",Zt,[a(m)?D("v-if",!0):(y(),$(je,{key:0,"model-value":a(b),"active-color":"primary",vertical:"","switch-indicator":"",align:"left"},{default:o(()=>[e(se,{name:"detail",label:"\u8BE6\u60C5",to:{name:`${t.type}_task`,params:{taskId:t.id}},replace:""},null,8,["to"]),e(se,{name:"logs",label:"\u65E5\u5FD7",to:{name:`${t.type}_task_logs`,params:{taskId:t.id}},replace:""},null,8,["to"])]),_:1},8,["model-value"]))])):D("v-if",!0)])])}}});var dl=Z(el,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/pages/TaskDetail.vue"]]);export{dl as default};

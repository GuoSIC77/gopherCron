var st=Object.defineProperty;var K=Object.getOwnPropertySymbols;var ot=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var X=(p,o,e)=>o in p?st(p,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[o]=e,C=(p,o)=>{for(var e in o||(o={}))ot.call(o,e)&&X(p,e,o[e]);if(K)for(var e of K(o))lt.call(o,e)&&X(p,e,o[e]);return p};import{Q as rt,b as nt,a as R,c as q}from"./QTabPanels.5a70b4bf.js";import{Q as ut}from"./QTooltip.06f39af2.js";import{cE as Y,j as A,u as U,c as y,o as z,k as O,r as $,B as Z,bp as D,l as v,E as T,s as t,z as a,x as n,q as u,y as x,Q as F,J as N,N as W,m as Q,aI as j,F as g,I as h,t as S,D as L}from"./index.3dc22d75.js";import{Q as P}from"./QInput.e861646c.js";import{Q as tt}from"./QSpace.8c8dc9da.js";import{Q as et}from"./QBadge.a24be9a0.js";import{Q as J}from"./QList.d39bc360.js";import{Q as M}from"./QScrollArea.cc59ff49.js";import{_ as at}from"./Confirm.8e353aa7.js";import{f as V}from"./datetime.6205e5a7.js";import{t as G,b as H}from"./thumbStyle.856de4cb.js";import"./use-key-composition.8cdda732.js";import"./focus-manager.c4b9c5ac.js";import"./touch.f559804c.js";import"./QDialog.9b0807e7.js";import"./rtl.b51694b1.js";import"./format.865294d5.js";import"./QCardActions.20536e91.js";import"./ClosePopup.1b684ed5.js";const it={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},ct={class:"q-pa-md tw-flex tw-justify-around"},dt={class:"tw-w-full tw-grow"},wt={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},mt={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},pt={class:"task__remark"},ft={class:"task__bottom-box"},_t={class:"task__bottom-time"},vt={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},kt=g(" \u6682\u65E0\u6570\u636E "),bt=A({props:{projectId:{type:Number,required:!0}},setup(p){const o=p,e=U(),d=y(()=>e.state.Task.loadingTasks);z(()=>{O(async()=>{e.dispatch("subscribeTopic",["/task/status/project/"+o.projectId]),await f()}),e.watch(l=>[l.Root.eventTask],([l])=>{if(!l||l.projectId!==o.projectId)return;const s=i.value.find(b=>b.id===l.taskId);s!==void 0&&e.commit("notifySuccess",{message:`\u4EFB\u52A1 ${s.name} \u5F53\u524D\u72B6\u6001: ${l.status}`}),f()})});async function f(){await e.dispatch("Task/fetchTasks",C({},o))}const w=$(""),i=y(()=>{var l;return((l=e.state.Task.tasks.get(o.projectId))==null?void 0:l.filter(s=>s.name.indexOf(w.value)>=0||s.id.toString().indexOf(w.value)>=0))||[]});function k(l){return L().params.taskId===l.id}const _=y(()=>i.value.filter(k).pop()),I=Z(),m=$(!1),E=$(!1);async function c(l,s){try{E.value=!0,e.commit("cleanError"),await e.dispatch("deleteTask",{projectId:l,taskId:s}),e.state.Root.currentError===void 0&&(I.push({name:"crontab_tasks",params:{projectId:l}}),m.value=!1,await f())}catch(b){console.error(b),e.commit("error",{error:b})}E.value=!1}return(l,s)=>{var B;const b=D("router-link");return v(),T("div",it,[t(at,{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=r=>m.value=r),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1"+((B=a(_))==null?void 0:B.name)+"?",type:"warning",loading:E.value,onConfirm:s[1]||(s[1]=r=>a(_)&&c(a(_).projectId,a(_).id))},null,8,["modelValue","content","loading"]),n("div",ct,[t(P,{modelValue:w.value,"onUpdate:modelValue":s[2]||(s[2]=r=>w.value=r),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:u(()=>[t(x,{name:"search"})]),_:1},8,["modelValue"]),t(F,{flat:"",dense:"",loading:a(d),icon:"refresh",onClick:f},null,8,["loading"]),t(F,{flat:"",dense:"",to:{name:"create_crontab_task"},icon:"add"}),t(F,{flat:"",dense:"",class:"tw-text-red-300 lg:tw-flex tw-hidden",icon:"delete",disable:!a(_),onClick:s[3]||(s[3]=r=>m.value=!0)},null,8,["disable"])]),n("div",dt,[t(M,{class:"tw-w-full tw-h-full tw-px-[15px]",visible:"","thumb-style":a(G),"bar-style":a(H)},{default:u(()=>[t(J,{class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4 tw-overflow-hidden tw-relative"},{default:u(()=>[(v(!0),T(N,null,W(a(i),r=>(v(),Q(b,{key:r.id,to:{name:"crontab_task",params:{taskId:r.id}}},{default:u(()=>[n("div",{class:j((k(r)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[n("div",wt,[n("div",mt,[t(x,{name:"schedule",class:"tw-inline"}),g(" "+h(r.cronExpr),1)]),t(tt),t(et,{outline:"",color:r.status===1?"green":"red",class:"tw-w-[50px]"},{default:u(()=>[g(h(r.isRunning==1?"\u6267\u884C\u4E2D":r.status==1?"\u8C03\u5EA6\u4E2D":"\u5DF2\u6682\u505C"),1)]),_:2},1032,["color"])]),n("div",{class:j((k(r)?"active ":"")+"task__title tw-flex-col tw-items-center tw-w-full")},[t(x,{name:"numbers"}),g(" "+h(r.name),1)],2),n("div",pt,h(r.remark||"-"),1),n("div",ft,[n("div",_t,h(a(V)(r.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1}),!a(d)&&(!a(i)||a(i).length===0)?(v(),T("div",vt,[t(x,{name:"outlet",style:{"font-size":"3rem"}}),kt])):S("",!0)]),_:1},8,["thumb-style","bar-style"])])])}}});var ht=Y(bt,[["__scopeId","data-v-253db7f4"]]);const xt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},yt={class:"q-pa-md tw-flex tw-justify-around"},gt={class:"tw-w-full tw-grow"},Tt={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},It={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},Et={class:"task__remark"},jt={class:"task__bottom-box"},$t={class:"task__bottom-time"},Ft={key:1,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},Bt=g(" \u6682\u65E0\u6570\u636E "),Ct=A({props:{projectId:{type:Number,required:!0}},setup(p){const o=p,e=$(""),d=U(),f=y(()=>d.state.Task.loadingTasks);async function w(){await d.dispatch("Task/fetchTasks",C({},o)),await d.dispatch("Task/fetchTemporaryTasks",C({},o))}z(async()=>{O(async()=>{await w()}),d.state.Task.tasks||await d.dispatch("Task/fetchTasks",{projectId:o.projectId})});const i=y(()=>d.state.Task.tasks.get(o.projectId)),k=y(()=>{var I;return((I=d.state.Task.temporaryTasks.get(o.projectId))==null?void 0:I.filter(m=>m.taskId.toString().indexOf(e.value)>=0))||[]});function _(I){const m=L();return Number(m.params.taskId)===I.id}return(I,m)=>{const E=D("router-link");return v(),T("div",xt,[n("div",yt,[t(P,{modelValue:e.value,"onUpdate:modelValue":m[0]||(m[0]=c=>e.value=c),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:u(()=>[t(x,{name:"search"})]),_:1},8,["modelValue"]),t(F,{flat:"",dense:"",loading:a(f),icon:"refresh",onClick:w},null,8,["loading"])]),n("div",gt,[t(M,{class:"tw-w-full tw-h-full tw-px-[15px]",visible:"","thumb-style":a(G),"bar-style":a(H)},{default:u(()=>[a(i)?(v(),Q(J,{key:0,class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:u(()=>[(v(!0),T(N,null,W(a(k),c=>(v(),Q(E,{key:c.id,to:{name:"temporary_task",params:{taskId:c.id}}},{default:u(()=>[n("div",{class:j((_(c)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[n("div",Tt,[n("div",It,[t(x,{name:"schedule",class:"tw-inline"}),g(" "+h(a(V)(c.scheduleTime*1e3)),1)]),t(tt),t(et,{outline:"",color:c.scheduleStatus===1?"green":"red",class:"tw-w-[50px]"},{default:u(()=>[g(h(c.isRunning==1?"\u6267\u884C\u4E2D":c.scheduleStatus==1?"\u7B49\u5F85\u4E2D":"\u5DF2\u5B8C\u6210"),1)]),_:2},1032,["color"])]),n("div",{class:j((_(c)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[t(x,{name:"numbers"}),g(" "+h(c.remark),1)],2),n("div",Et,"\u521B\u5EFA\u4EBA\uFF1A"+h(c.userName||"-"),1),n("div",jt,[n("div",$t,h(a(V)(c.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1})):S("",!0),!a(f)&&(!a(k)||a(k).length===0)?(v(),T("div",Ft,[t(x,{name:"outlet",style:{"font-size":"3rem"}}),Bt])):S("",!0)]),_:1},8,["thumb-style","bar-style"])])])}}});var Qt=Y(Ct,[["__scopeId","data-v-0ba1ef0c"]]);const St={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Vt={class:"q-pa-md tw-flex tw-justify-around"},At={class:"tw-w-full tw-grow"},Dt={class:"task__remark"},Nt={class:"task__bottom-box"},Lt={class:"task__bottom-time"},Rt={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},qt=g(" \u6682\u65E0\u6570\u636E "),Ut=A({props:{projectId:{type:Number,required:!0}},setup(p){const o=p,e=U(),d=y(()=>e.state.WorkFlowTask.loadingTasks);z(()=>{O(async()=>{await f()}),e.watch(l=>[l.Root.eventWorkFlowTask],([l])=>{if(!l||l.projectId!==o.projectId)return;const s=i.value.find(b=>b.id===l.taskId);s!==void 0&&e.commit("notifySuccess",{message:`\u4EFB\u52A1 ${s.name} \u5F53\u524D\u72B6\u6001: ${l.status}`}),f()})});async function f(){await e.dispatch("WorkFlowTask/fetchTasks",C({},o))}const w=$(""),i=y(()=>{var l;return((l=e.state.WorkFlowTask.tasks.get(o.projectId))==null?void 0:l.filter(s=>s.name.indexOf(w.value)>=0||s.id.toString().indexOf(w.value)>=0))||[]});function k(l){return L().params.taskId===l.id}const _=y(()=>i.value.filter(k).pop()),I=Z(),m=$(!1),E=$(!1);async function c(l,s){E.value=!0;try{e.commit("cleanError"),await e.dispatch("deleteWorkFlowTask",{projectId:l,taskId:s}),e.state.Root.currentError===void 0&&(I.push({name:"workflow_tasks",params:{projectId:l}}),m.value=!1,await f())}catch(b){console.error(b),e.commit("error",{error:b})}E.value=!1}return(l,s)=>{var B;const b=D("router-link");return v(),T("div",St,[t(at,{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=r=>m.value=r),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1"+((B=a(_))==null?void 0:B.name)+"?",type:"warning",loading:E.value,onConfirm:s[1]||(s[1]=r=>a(_)&&c(a(_).projectId,a(_).id))},null,8,["modelValue","content","loading"]),n("div",Vt,[t(P,{modelValue:w.value,"onUpdate:modelValue":s[2]||(s[2]=r=>w.value=r),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:u(()=>[t(x,{name:"search"})]),_:1},8,["modelValue"]),t(F,{flat:"",dense:"",loading:a(d),icon:"refresh",onClick:f},null,8,["loading"]),t(F,{flat:"",dense:"",to:{name:"create_workflow_task"},icon:"add"}),t(F,{flat:"",dense:"",class:"tw-text-red-300 lg:tw-flex tw-hidden",icon:"delete",disable:!a(_),onClick:s[3]||(s[3]=r=>m.value=!0)},null,8,["disable"])]),n("div",At,[t(M,{class:"tw-h-full tw-w-full tw-px-[15px]",visible:"","thumb-style":a(G),"bar-style":a(H)},{default:u(()=>[t(J,{class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:u(()=>[(v(!0),T(N,null,W(a(i),r=>(v(),Q(b,{key:r.id,to:{name:"workflow_task",params:{taskId:r.id}}},{default:u(()=>[n("div",{class:j((k(r)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-py-3 tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[n("div",{class:j((k(r)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[t(x,{name:"numbers"}),g(" "+h(r.name),1)],2),n("div",Dt,h(r.remark||"-"),1),n("div",Nt,[n("div",Lt,h(a(V)(r.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1}),!a(d)&&(!a(i)||a(i).length===0)?(v(),T("div",Rt,[t(x,{name:"outlet",style:{"font-size":"3rem"}}),qt])):S("",!0)]),_:1},8,["thumb-style","bar-style"])])])}}}),zt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Ot=g(" \u6307\u5B9A\u65F6\u95F4\u8C03\u5EA6\u4E00\u6B21\u7684\u4EFB\u52A1 "),ce=A({props:{projectId:{type:Number,required:!0}},setup(p){const o=p,e=L(),d=y(()=>e.name&&!["crontab_tasks","workflow_tasks","temporary_tasks"].includes(e.name.toString())),f=y(()=>{var w;if(e.name){const i=e.name.toString();if(i.search("crontab")>=0)return"normal";if(i.search("workflow")>=0)return"workflow";if(i.search("temporary")>=0)return"temporary"}throw new Error(`Unknown route name ${(w=e.name)==null?void 0:w.toString()}`)});return(w,i)=>{const k=D("router-view");return v(),T(N,null,[n("div",{class:j("xl:tw-basis-1/5 tw-basis-1/4 tw-w-full tw-h-full tw-bg-[#1E1E1E] tw-min-w-[280px]"+(a(d)?" tw-hidden lg:tw-block":""))},[n("div",zt,[t(rt,{"model-value":a(f),"active-color":"primary"},{default:u(()=>[t(R,{name:"crontab",label:"\u666E\u901A",to:{name:"crontab_tasks",params:{projectId:o.projectId}},replace:""},null,8,["to"]),t(R,{name:"temporary",label:"\u4E34\u65F6",to:{name:"temporary_tasks",params:{projectId:o.projectId}},replace:""},{default:u(()=>[t(ut,{class:"bg-warning tw-text-black",offset:[10,10]},{default:u(()=>[Ot]),_:1})]),_:1},8,["to"]),t(R,{name:"workflow",label:"\u4EFB\u52A1\u6D41",to:{name:"workflow_tasks",params:{projectId:o.projectId}},replace:""},null,8,["to"])]),_:1},8,["model-value"]),t(nt,{"model-value":a(f),animated:"",class:"tw-w-full tw-grow"},{default:u(()=>[t(q,{name:"normal",class:"tw-p-0"},{default:u(()=>[t(ht,{"project-id":o.projectId},null,8,["project-id"])]),_:1}),t(q,{name:"temporary",class:"tw-p-0"},{default:u(()=>[t(Qt,{"project-id":o.projectId},null,8,["project-id"])]),_:1}),t(q,{name:"workflow",class:"tw-p-0"},{default:u(()=>[t(Ut,{"project-id":o.projectId},null,8,["project-id"])]),_:1})]),_:1},8,["model-value"])])],2),n("div",{class:j("xl:tw-basis-3/5 tw-basis-1/2 tw-h-full tw-w-full"+(a(d)?"":" tw-hidden lg:tw-block"))},[t(k)],2)],64)}}});export{ce as default};

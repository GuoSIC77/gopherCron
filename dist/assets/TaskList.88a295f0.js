var ut=Object.defineProperty;var st=Object.getOwnPropertySymbols;var it=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;var at=(v,o,e)=>o in v?ut(v,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):v[o]=e,z=(v,o)=>{for(var e in o||(o={}))it.call(o,e)&&at(v,e,o[e]);if(st)for(var e of st(o))ct.call(o,e)&&at(v,e,o[e]);return v};import{_ as D,k as Q,u as H,l as E,H as N,m as J,n as M,r as $,J as ot,ag as U,o as b,K as j,a as t,A as s,b as l,w as n,q as I,f as Y,h as B,al as G,Y as q,a8 as X,c as L,a2 as S,d as x,t as g,aj as lt,ay as rt,p as A,a4 as Z,a3 as dt,a6 as wt,a5 as O,L as W,a7 as P}from"./index.a78b90e1.js";import{C as nt}from"./Confirm.356f7c34.js";import{T as K}from"./task.f3ffd066.js";import{f as R}from"./datetime.561112b0.js";import{t as tt,b as et}from"./thumbStyle.856de4cb.js";const pt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},mt={class:"q-pa-md tw-flex tw-justify-around"},ft={class:"tw-w-full tw-grow"},_t={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},vt={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},kt={class:"task__remark"},ht={class:"task__bottom-box"},bt={class:"task__bottom-time"},gt={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},xt=x(" \u6682\u65E0\u6570\u636E "),yt=Q({props:{projectId:{type:Number,required:!0}},setup(v){const o=v,e=H(),p=E(()=>e.state.Task.loadingTasks),k=N();J(()=>{M(async()=>{e.dispatch("subscribeTopic",["/task/status/project/"+o.projectId]),c.value="",await _(),k.params.taskId&&h(k.params.taskId)}),e.watch(u=>[u.Root.eventTask],([u])=>{if(!u||u.projectId!==o.projectId)return;const a=m.value.find(T=>T.id===u.taskId);a!==void 0&&(e.commit("notifySuccess",{message:`\u4EFB\u52A1 ${a.name} \u5F53\u524D\u72B6\u6001: ${u.status}`}),e.commit("Task/updateTaskStatus",{projectId:a.projectId,taskId:a.id,isRunning:K.isRunning(u.status)}))})});async function _(){await e.dispatch("Task/fetchTasks",z({},o))}const c=$(""),m=E(()=>{var u;return((u=e.state.Task.tasks.get(o.projectId))==null?void 0:u.filter(a=>a.name.indexOf(c.value)>=0||a.id.toString().indexOf(c.value)>=0))||[]}),r=$();function h(u){const a=r.value;if(!a||!m.value)return;const T=m.value.findIndex(C=>C.id===u);setTimeout(()=>{if(T<0)a.setScrollPercentage("vertical",0);else{const C=1*T/m.value.length*a.getScroll().verticalSize-150;a.setScrollPosition("vertical",C)}},100)}function y(u){return k.params.taskId===u.id}const i=E(()=>m.value.filter(y).pop()),V=ot();V.beforeEach((u,a,T)=>{!a.params.taskId&&u.params.taskId&&h(u.params.taskId),T()});const w=$(!1),d=$(!1);async function F(u,a){try{d.value=!0,e.commit("cleanError"),await e.dispatch("deleteTask",{projectId:u,taskId:a}),e.state.Root.currentError===void 0&&(V.push({name:"crontab_tasks",params:{projectId:u}}),w.value=!1,await _())}catch(T){console.error(T),e.commit("error",{error:T})}d.value=!1}return(u,a)=>{var C;const T=U("router-link");return b(),j("div",pt,[t(nt,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=f=>w.value=f),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1"+((C=s(i))==null?void 0:C.name)+"?",type:"warning",loading:d.value,onConfirm:a[1]||(a[1]=f=>s(i)&&F(s(i).projectId,s(i).id))},null,8,["modelValue","content","loading"]),l("div",mt,[t(Y,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=f=>c.value=f),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:n(()=>[t(I,{name:"search"})]),_:1},8,["modelValue"]),t(B,{flat:"",dense:"",loading:s(p),icon:"refresh",onClick:_},null,8,["loading"]),t(B,{flat:"",dense:"",to:{name:"create_crontab_task"},icon:"add"}),t(B,{flat:"",dense:"",class:"tw-text-red-300 lg:tw-flex tw-hidden",icon:"delete",disable:!s(i),onClick:a[3]||(a[3]=f=>w.value=!0)},null,8,["disable"])]),l("div",ft,[t(s(Z),{ref_key:"scrollArea",ref:r,class:"tw-w-full tw-h-full tw-px-[15px]",visible:"","thumb-style":s(tt),"bar-style":s(et)},{default:n(()=>[t(G,{class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4 tw-overflow-hidden tw-relative"},{default:n(()=>[(b(!0),j(q,null,X(s(m),f=>(b(),L(T,{key:f.id,to:{name:"crontab_task",params:{taskId:f.id}}},{default:n(()=>[l("div",{class:S((y(f)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-lg tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[l("div",_t,[l("div",vt,[t(I,{name:"schedule",class:"tw-inline"}),x(" "+g(f.cronExpr),1)]),t(lt),t(rt,{outline:"",color:f.status===1?"green":"red",class:"tw-w-[50px]"},{default:n(()=>[x(g(f.isRunning==1?"\u6267\u884C\u4E2D":f.status==1?"\u8C03\u5EA6\u4E2D":"\u5DF2\u6682\u505C"),1)]),_:2},1032,["color"]),A(` <div :class="'tw-w-[50px] task__status' + task.status"></div> `)]),l("div",{class:S((y(f)?"active ":"")+"task__title tw-flex-col tw-items-center tw-w-full")},[t(I,{name:"numbers"}),x(" "+g(f.name),1)],2),l("div",kt,g(f.remark||"-"),1),l("div",ht,[l("div",bt,g(s(R)(f.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1}),!s(p)&&(!s(m)||s(m).length===0)?(b(),j("div",gt,[t(I,{name:"outlet",style:{"font-size":"3rem"}}),xt])):A("v-if",!0)]),_:1},8,["thumb-style","bar-style"])])])}}});var Tt=D(yt,[["__scopeId","data-v-189e9673"],["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/TaskList.vue"]]);const It={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Et={class:"q-pa-md tw-flex tw-justify-around"},jt={class:"tw-w-full tw-grow"},Ft={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},$t={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},St={class:"task__remark"},Bt={class:"task__bottom-box"},Ct={class:"task__bottom-time"},At={key:1,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},Vt=x(" \u6682\u65E0\u6570\u636E "),Lt=Q({props:{projectId:{type:Number,required:!0}},setup(v){const o=v,e=$(""),p=H(),k=E(()=>p.state.Task.loadingTasks);J(async()=>{M(async()=>{await _(),p.dispatch("subscribeTopic",["/task/status/project/"+o.projectId])}),p.state.Task.temporaryTasks||await _(),p.watch(r=>[r.Root.eventTask],async([r])=>{if(!r||r.projectId!==o.projectId)return;const h=c.value.find(y=>y.tmpId===r.tmpId);!h||(p.commit("notifySuccess",{message:`\u4EFB\u52A1 ${h.remark} \u5F53\u524D\u72B6\u6001: ${r.status}`}),p.commit("Task/updateTemporaryTaskStatus",{projectId:o.projectId,tmpId:r.tmpId,isRunning:K.isRunning(r.status),finished:K.isFinished(r.status)}))})});async function _(){try{await p.dispatch("Task/fetchTemporaryTasks",{projectId:o.projectId})}catch(r){console.error("failed to dispatch fetchTemporaryTasks",r)}}const c=E(()=>{var r;return((r=p.state.Task.temporaryTasks.get(o.projectId))==null?void 0:r.filter(h=>h.taskId.toString().indexOf(e.value)>=0))||[]});function m(r){const h=N();return Number(h.params.taskId)===r.id}return(r,h)=>{const y=U("router-link");return b(),j("div",It,[l("div",Et,[t(Y,{modelValue:e.value,"onUpdate:modelValue":h[0]||(h[0]=i=>e.value=i),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:n(()=>[t(I,{name:"search"})]),_:1},8,["modelValue"]),t(B,{flat:"",dense:"",loading:s(k),icon:"refresh",onClick:_},null,8,["loading"])]),l("div",jt,[t(Z,{class:"tw-w-full tw-h-full tw-px-[15px]",visible:"","thumb-style":s(tt),"bar-style":s(et)},{default:n(()=>[s(c)?(b(),L(G,{key:0,class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:n(()=>[(b(!0),j(q,null,X(s(c),i=>(b(),L(y,{key:i.id,to:{name:"temporary_task",params:{taskId:i.id}}},{default:n(()=>[l("div",{class:S((m(i)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-lg tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[l("div",Ft,[l("div",$t,[t(I,{name:"schedule",class:"tw-inline"}),x(" "+g(s(R)(i.scheduleTime*1e3)),1)]),t(lt),t(rt,{outline:"",color:i.scheduleStatus===1?"green":"red",class:"tw-w-[50px]"},{default:n(()=>[x(g(i.isRunning==1?"\u6267\u884C\u4E2D":i.scheduleStatus==1?"\u7B49\u5F85\u4E2D":"\u5DF2\u5904\u7406"),1)]),_:2},1032,["color"]),A(` <div :class="'tw-w-[50px] task__status' + task.status"></div> `)]),l("div",{class:S((m(i)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[t(I,{name:"numbers"}),x(" "+g(i.remark),1)],2),l("div",St,"\u521B\u5EFA\u4EBA\uFF1A"+g(i.userName||"-"),1),l("div",Bt,[l("div",Ct,g(s(R)(i.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1})):A("v-if",!0),!s(k)&&(!s(c)||s(c).length===0)?(b(),j("div",At,[t(I,{name:"outlet",style:{"font-size":"3rem"}}),Vt])):A("v-if",!0)]),_:1},8,["thumb-style","bar-style"])])])}}});var Rt=D(Lt,[["__scopeId","data-v-38f53198"],["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/TemporaryTaskList.vue"]]);const Dt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Qt={class:"q-pa-md tw-flex tw-justify-around"},Nt={class:"tw-w-full tw-grow"},Ut={class:"task__remark"},qt={class:"task__bottom-box"},zt={class:"task__bottom-time"},Ot={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},Wt=x(" \u6682\u65E0\u6570\u636E "),Pt=Q({props:{projectId:{type:Number,required:!0}},setup(v){const o=v,e=H(),p=E(()=>e.state.WorkFlowTask.loadingTasks);J(()=>{M(async()=>{await k()}),e.dispatch("subscribeTopic",["/task/status/project/"+o.projectId]),e.watch(w=>[w.Root.eventWorkFlowTask],([w])=>{if(!w||w.projectId!==o.projectId)return;const d=c.value.find(F=>F.id===w.taskId);d!==void 0&&e.commit("notifySuccess",{message:`\u4EFB\u52A1 ${d.name} \u5F53\u524D\u72B6\u6001: ${w.status}`}),k()})});async function k(){await e.dispatch("WorkFlowTask/fetchTasks",z({},o))}const _=$(""),c=E(()=>{var w;return((w=e.state.WorkFlowTask.tasks.get(o.projectId))==null?void 0:w.filter(d=>d.name.indexOf(_.value)>=0||d.id.toString().indexOf(_.value)>=0))||[]});function m(w){return N().params.taskId===w.id}const r=E(()=>c.value.filter(m).pop()),h=ot(),y=$(!1),i=$(!1);async function V(w,d){i.value=!0;try{e.commit("cleanError"),await e.dispatch("deleteWorkFlowTask",{projectId:w,taskId:d}),e.state.Root.currentError===void 0&&(h.push({name:"workflow_tasks",params:{projectId:w}}),y.value=!1,await k())}catch(F){console.error(F),e.commit("error",{error:F})}i.value=!1}return(w,d)=>{var u;const F=U("router-link");return b(),j("div",Dt,[t(nt,{modelValue:y.value,"onUpdate:modelValue":d[0]||(d[0]=a=>y.value=a),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1"+((u=s(r))==null?void 0:u.name)+"?",type:"warning",loading:i.value,onConfirm:d[1]||(d[1]=a=>s(r)&&V(s(r).projectId,s(r).id))},null,8,["modelValue","content","loading"]),l("div",Qt,[t(Y,{modelValue:_.value,"onUpdate:modelValue":d[2]||(d[2]=a=>_.value=a),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:n(()=>[t(I,{name:"search"})]),_:1},8,["modelValue"]),t(B,{flat:"",dense:"",loading:s(p),icon:"refresh",onClick:k},null,8,["loading"]),t(B,{flat:"",dense:"",to:{name:"create_workflow_task"},icon:"add"}),t(B,{flat:"",dense:"",class:"tw-text-red-300 lg:tw-flex tw-hidden",icon:"delete",disable:!s(r),onClick:d[3]||(d[3]=a=>y.value=!0)},null,8,["disable"])]),l("div",Nt,[t(Z,{class:"tw-h-full tw-w-full tw-px-[15px]",visible:"","thumb-style":s(tt),"bar-style":s(et)},{default:n(()=>[t(G,{class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:n(()=>[(b(!0),j(q,null,X(s(c),a=>(b(),L(F,{key:a.id,to:{name:"workflow_task",params:{taskId:a.id}}},{default:n(()=>[l("div",{class:S((m(a)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-py-3 tw-rounded-lg tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[l("div",{class:S((m(a)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[t(I,{name:"numbers"}),x(" "+g(a.name),1)],2),l("div",Ut,g(a.remark||"-"),1),l("div",qt,[l("div",zt,g(s(R)(a.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1}),!s(p)&&(!s(c)||s(c).length===0)?(b(),j("div",Ot,[t(I,{name:"outlet",style:{"font-size":"3rem"}}),Wt])):A("v-if",!0)]),_:1},8,["thumb-style","bar-style"])])])}}});var Kt=D(Pt,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/WorkFlowTaskList.vue"]]);const Ht={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Jt=x(" \u65E5\u5E38\u5468\u671F\u6027\u5B9A\u65F6\u6267\u884C\u7684\u4EFB\u52A1 "),Mt=x(" \u6307\u5B9A\u65F6\u95F4\u8C03\u5EA6\u4E00\u6B21\u7684\u4EFB\u52A1 "),Yt=x(" \u7528\u4E8E\u4EFB\u52A1\u7F16\u6392\u7684\u5B50\u4EFB\u52A1 "),Gt=Q({props:{projectId:{type:Number,required:!0}},setup(v){const o=v,e=N(),p=E(()=>e.name&&!["crontab_tasks","workflow_tasks","temporary_tasks"].includes(e.name.toString())),k=E(()=>{var _;if(e.name){const c=e.name.toString();if(c.search("crontab")>=0)return"normal";if(c.search("workflow")>=0)return"workflow";if(c.search("temporary")>=0)return"temporary"}throw new Error(`Unknown route name ${(_=e.name)==null?void 0:_.toString()}`)});return(_,c)=>{const m=U("router-view");return b(),j(q,null,[l("div",{class:S("xl:tw-basis-1/5 tw-basis-1/4 tw-w-full tw-h-full tw-bg-[#1E1E1E] tw-min-w-[280px]"+(s(p)?" tw-hidden lg:tw-block":""))},[l("div",Ht,[t(dt,{"model-value":s(k),"active-color":"primary"},{default:n(()=>[t(O,{name:"crontab",label:"\u666E\u901A",to:{name:"crontab_tasks",params:{projectId:o.projectId}},replace:""},{default:n(()=>[t(W,{class:"bg-warning tw-text-black",offset:[10,10]},{default:n(()=>[Jt]),_:1})]),_:1},8,["to"]),t(O,{name:"temporary",label:"\u4E34\u65F6",to:{name:"temporary_tasks",params:{projectId:o.projectId}},replace:""},{default:n(()=>[t(W,{class:"bg-warning tw-text-black",offset:[10,10]},{default:n(()=>[Mt]),_:1})]),_:1},8,["to"]),t(O,{name:"workflow",label:"\u4EFB\u52A1\u6D41",to:{name:"workflow_tasks",params:{projectId:o.projectId}},replace:""},{default:n(()=>[t(W,{class:"bg-warning tw-text-black",offset:[10,10]},{default:n(()=>[Yt]),_:1})]),_:1},8,["to"])]),_:1},8,["model-value"]),t(wt,{"model-value":s(k),animated:"",class:"tw-w-full tw-grow"},{default:n(()=>[t(P,{name:"normal",class:"tw-p-0"},{default:n(()=>[t(Tt,{"project-id":o.projectId},null,8,["project-id"])]),_:1}),t(P,{name:"temporary",class:"tw-p-0"},{default:n(()=>[t(Rt,{"project-id":o.projectId},null,8,["project-id"])]),_:1}),t(P,{name:"workflow",class:"tw-p-0"},{default:n(()=>[t(Kt,{"project-id":o.projectId},null,8,["project-id"])]),_:1})]),_:1},8,["model-value"])])],2),l("div",{class:S("xl:tw-basis-3/5 tw-basis-1/2 tw-h-full tw-w-full"+(s(p)?"":" tw-hidden lg:tw-block"))},[t(m)],2)],64)}}});var oe=D(Gt,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/pages/TaskList.vue"]]);export{oe as default};

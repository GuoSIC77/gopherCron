var ut=Object.defineProperty;var et=Object.getOwnPropertySymbols;var it=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;var at=(v,o,e)=>o in v?ut(v,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):v[o]=e,U=(v,o)=>{for(var e in o||(o={}))it.call(o,e)&&at(v,e,o[e]);if(et)for(var e of et(o))ct.call(o,e)&&at(v,e,o[e]);return v};import{Q as z}from"./QTooltip.dcdb9de2.js";import{Q as dt,b as wt,a as O,c as P}from"./QTabPanels.3a96ca26.js";import{df as st,q as D,s as K,c as E,O as N,t as G,x as M,r as F,N as ot,bK as L,y as k,R as j,B as t,K as a,F as l,A as n,G as T,D as Z,Q as B,Z as q,bI as H,z as Q,a1 as S,S as g,W as x,E as V}from"./index.7a92b1b1.js";import{Q as lt}from"./QSpace.beef6455.js";import{Q as rt}from"./QBadge.00994b6d.js";import{Q as J}from"./QList.e5a4450e.js";import{Q as X}from"./QScrollArea.26c9c5a7.js";import{_ as nt}from"./Confirm.e2a3b850.js";import{T as W}from"./task.f3ffd066.js";import{f as R}from"./datetime.561112b0.js";import{t as Y,b as tt}from"./thumbStyle.856de4cb.js";import"./touch.04557d5f.js";import"./rtl.b51694b1.js";import"./format.865294d5.js";import"./ClosePopup.13563e94.js";const mt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},pt={class:"q-pa-md tw-flex tw-justify-around"},ft={class:"tw-w-full tw-grow"},_t={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},vt={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},bt={class:"task__remark"},ht={class:"task__bottom-box"},kt={class:"task__bottom-time"},xt={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},gt=g(" \u6682\u65E0\u6570\u636E "),yt=D({props:{projectId:{type:Number,required:!0}},setup(v){const o=v,e=K(),m=E(()=>e.state.Task.loadingTasks),b=N();G(()=>{M(async()=>{e.dispatch("subscribeTopic",["/task/status/project/"+o.projectId]),c.value="",await _(),b.params.taskId&&h(b.params.taskId)}),e.watch(u=>[u.Root.eventTask],([u])=>{if(!u||u.projectId!==o.projectId)return;const s=p.value.find(I=>I.id===u.taskId);s!==void 0&&(e.commit("notifySuccess",{message:`\u4EFB\u52A1 ${s.name} \u5F53\u524D\u72B6\u6001: ${u.status}`}),e.commit("Task/updateTaskStatus",{projectId:s.projectId,taskId:s.id,isRunning:W.isRunning(u.status)}))})});async function _(){await e.dispatch("Task/fetchTasks",U({},o))}const c=F(""),p=E(()=>{var u;return((u=e.state.Task.tasks.get(o.projectId))==null?void 0:u.filter(s=>s.name.indexOf(c.value)>=0||s.id.toString().indexOf(c.value)>=0))||[]}),r=F();function h(u){const s=r.value;if(!s||!p.value)return;const I=p.value.findIndex(A=>A.id===u);setTimeout(()=>{if(I<0)s.setScrollPercentage("vertical",0);else{const A=1*I/p.value.length*s.getScroll().verticalSize-150;s.setScrollPosition("vertical",A)}},100)}function y(u){return b.params.taskId===u.id}const i=E(()=>p.value.filter(y).pop()),C=ot();C.beforeEach((u,s,I)=>{!s.params.taskId&&u.params.taskId&&h(u.params.taskId),I()});const w=F(!1),d=F(!1);async function $(u,s){try{d.value=!0,e.commit("cleanError"),await e.dispatch("deleteTask",{projectId:u,taskId:s}),e.state.Root.currentError===void 0&&(C.push({name:"crontab_tasks",params:{projectId:u}}),w.value=!1,await _())}catch(I){console.error(I),e.commit("error",{error:I})}d.value=!1}return(u,s)=>{var A;const I=L("router-link");return k(),j("div",mt,[t(nt,{modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=f=>w.value=f),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1"+((A=a(i))==null?void 0:A.name)+"?",type:"warning",loading:d.value,onConfirm:s[1]||(s[1]=f=>a(i)&&$(a(i).projectId,a(i).id))},null,8,["modelValue","content","loading"]),l("div",pt,[t(Z,{modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=f=>c.value=f),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:n(()=>[t(T,{name:"search"})]),_:1},8,["modelValue"]),t(B,{flat:"",dense:"",loading:a(m),icon:"refresh",onClick:_},null,8,["loading"]),t(B,{flat:"",dense:"",to:{name:"create_crontab_task"},icon:"add"}),t(B,{flat:"",dense:"",class:"tw-text-red-300 lg:tw-flex tw-hidden",icon:"delete",disable:!a(i),onClick:s[3]||(s[3]=f=>w.value=!0)},null,8,["disable"])]),l("div",ft,[t(a(X),{ref_key:"scrollArea",ref:r,class:"tw-w-full tw-h-full tw-px-[15px]",visible:"","thumb-style":a(Y),"bar-style":a(tt)},{default:n(()=>[t(J,{class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4 tw-overflow-hidden tw-relative"},{default:n(()=>[(k(!0),j(q,null,H(a(p),f=>(k(),Q(I,{key:f.id,to:{name:"crontab_task",params:{taskId:f.id}}},{default:n(()=>[l("div",{class:S((y(f)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[l("div",_t,[l("div",vt,[t(T,{name:"schedule",class:"tw-inline"}),g(" "+x(f.cronExpr),1)]),t(lt),t(rt,{outline:"",color:f.status===1?"green":"red",class:"tw-w-[50px]"},{default:n(()=>[g(x(f.isRunning==1?"\u6267\u884C\u4E2D":f.status==1?"\u8C03\u5EA6\u4E2D":"\u5DF2\u6682\u505C"),1)]),_:2},1032,["color"])]),l("div",{class:S((y(f)?"active ":"")+"task__title tw-flex-col tw-items-center tw-w-full")},[t(T,{name:"numbers"}),g(" "+x(f.name),1)],2),l("div",bt,x(f.remark||"-"),1),l("div",ht,[l("div",kt,x(a(R)(f.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1}),!a(m)&&(!a(p)||a(p).length===0)?(k(),j("div",xt,[t(T,{name:"outlet",style:{"font-size":"3rem"}}),gt])):V("",!0)]),_:1},8,["thumb-style","bar-style"])])])}}});var It=st(yt,[["__scopeId","data-v-15ae19a6"]]);const Tt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Et={class:"q-pa-md tw-flex tw-justify-around"},jt={class:"tw-w-full tw-grow"},$t={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},Ft={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},St={class:"task__remark"},Bt={class:"task__bottom-box"},At={class:"task__bottom-time"},Ct={key:1,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},Qt=g(" \u6682\u65E0\u6570\u636E "),Vt=D({props:{projectId:{type:Number,required:!0}},setup(v){const o=v,e=F(""),m=K(),b=E(()=>m.state.Task.loadingTasks);G(async()=>{M(async()=>{await _(),m.dispatch("subscribeTopic",["/task/status/project/"+o.projectId])}),m.state.Task.temporaryTasks||await _(),m.watch(r=>[r.Root.eventTask],async([r])=>{if(!r||r.projectId!==o.projectId)return;const h=c.value.find(y=>y.tmpId===r.tmpId);!h||(m.commit("notifySuccess",{message:`\u4EFB\u52A1 ${h.remark} \u5F53\u524D\u72B6\u6001: ${r.status}`}),m.commit("Task/updateTemporaryTaskStatus",{projectId:o.projectId,tmpId:r.tmpId,isRunning:W.isRunning(r.status),finished:W.isFinished(r.status)}))})});async function _(){try{await m.dispatch("Task/fetchTemporaryTasks",{projectId:o.projectId})}catch(r){console.error("failed to dispatch fetchTemporaryTasks",r)}}const c=E(()=>{var r;return((r=m.state.Task.temporaryTasks.get(o.projectId))==null?void 0:r.filter(h=>h.taskId.toString().indexOf(e.value)>=0))||[]});function p(r){const h=N();return Number(h.params.taskId)===r.id}return(r,h)=>{const y=L("router-link");return k(),j("div",Tt,[l("div",Et,[t(Z,{modelValue:e.value,"onUpdate:modelValue":h[0]||(h[0]=i=>e.value=i),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:n(()=>[t(T,{name:"search"})]),_:1},8,["modelValue"]),t(B,{flat:"",dense:"",loading:a(b),icon:"refresh",onClick:_},null,8,["loading"])]),l("div",jt,[t(X,{class:"tw-w-full tw-h-full tw-px-[15px]",visible:"","thumb-style":a(Y),"bar-style":a(tt)},{default:n(()=>[a(c)?(k(),Q(J,{key:0,class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:n(()=>[(k(!0),j(q,null,H(a(c),i=>(k(),Q(y,{key:i.id,to:{name:"temporary_task",params:{taskId:i.id}}},{default:n(()=>[l("div",{class:S((p(i)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[l("div",$t,[l("div",Ft,[t(T,{name:"schedule",class:"tw-inline"}),g(" "+x(a(R)(i.scheduleTime*1e3)),1)]),t(lt),t(rt,{outline:"",color:i.scheduleStatus===1?"green":"red",class:"tw-w-[50px]"},{default:n(()=>[g(x(i.isRunning==1?"\u6267\u884C\u4E2D":i.scheduleStatus==1?"\u7B49\u5F85\u4E2D":"\u5DF2\u5B8C\u6210"),1)]),_:2},1032,["color"])]),l("div",{class:S((p(i)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[t(T,{name:"numbers"}),g(" "+x(i.remark),1)],2),l("div",St,"\u521B\u5EFA\u4EBA\uFF1A"+x(i.userName||"-"),1),l("div",Bt,[l("div",At,x(a(R)(i.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1})):V("",!0),!a(b)&&(!a(c)||a(c).length===0)?(k(),j("div",Ct,[t(T,{name:"outlet",style:{"font-size":"3rem"}}),Qt])):V("",!0)]),_:1},8,["thumb-style","bar-style"])])])}}});var Rt=st(Vt,[["__scopeId","data-v-2a34bd7a"]]);const Dt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Nt={class:"q-pa-md tw-flex tw-justify-around"},Lt={class:"tw-w-full tw-grow"},qt={class:"task__remark"},Ut={class:"task__bottom-box"},zt={class:"task__bottom-time"},Ot={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},Pt=g(" \u6682\u65E0\u6570\u636E "),Wt=D({props:{projectId:{type:Number,required:!0}},setup(v){const o=v,e=K(),m=E(()=>e.state.WorkFlowTask.loadingTasks);G(()=>{M(async()=>{await b()}),e.watch(w=>[w.Root.eventWorkFlowTask],([w])=>{if(!w||w.projectId!==o.projectId)return;const d=c.value.find($=>$.id===w.taskId);d!==void 0&&e.commit("notifySuccess",{message:`\u4EFB\u52A1 ${d.name} \u5F53\u524D\u72B6\u6001: ${w.status}`}),b()})});async function b(){await e.dispatch("WorkFlowTask/fetchTasks",U({},o))}const _=F(""),c=E(()=>{var w;return((w=e.state.WorkFlowTask.tasks.get(o.projectId))==null?void 0:w.filter(d=>d.name.indexOf(_.value)>=0||d.id.toString().indexOf(_.value)>=0))||[]});function p(w){return N().params.taskId===w.id}const r=E(()=>c.value.filter(p).pop()),h=ot(),y=F(!1),i=F(!1);async function C(w,d){i.value=!0;try{e.commit("cleanError"),await e.dispatch("deleteWorkFlowTask",{projectId:w,taskId:d}),e.state.Root.currentError===void 0&&(h.push({name:"workflow_tasks",params:{projectId:w}}),y.value=!1,await b())}catch($){console.error($),e.commit("error",{error:$})}i.value=!1}return(w,d)=>{var u;const $=L("router-link");return k(),j("div",Dt,[t(nt,{modelValue:y.value,"onUpdate:modelValue":d[0]||(d[0]=s=>y.value=s),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1"+((u=a(r))==null?void 0:u.name)+"?",type:"warning",loading:i.value,onConfirm:d[1]||(d[1]=s=>a(r)&&C(a(r).projectId,a(r).id))},null,8,["modelValue","content","loading"]),l("div",Nt,[t(Z,{modelValue:_.value,"onUpdate:modelValue":d[2]||(d[2]=s=>_.value=s),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:n(()=>[t(T,{name:"search"})]),_:1},8,["modelValue"]),t(B,{flat:"",dense:"",loading:a(m),icon:"refresh",onClick:b},null,8,["loading"]),t(B,{flat:"",dense:"",to:{name:"create_workflow_task"},icon:"add"}),t(B,{flat:"",dense:"",class:"tw-text-red-300 lg:tw-flex tw-hidden",icon:"delete",disable:!a(r),onClick:d[3]||(d[3]=s=>y.value=!0)},null,8,["disable"])]),l("div",Lt,[t(X,{class:"tw-h-full tw-w-full tw-px-[15px]",visible:"","thumb-style":a(Y),"bar-style":a(tt)},{default:n(()=>[t(J,{class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:n(()=>[(k(!0),j(q,null,H(a(c),s=>(k(),Q($,{key:s.id,to:{name:"workflow_task",params:{taskId:s.id}}},{default:n(()=>[l("div",{class:S((p(s)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-py-3 tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[l("div",{class:S((p(s)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[t(T,{name:"numbers"}),g(" "+x(s.name),1)],2),l("div",qt,x(s.remark||"-"),1),l("div",Ut,[l("div",zt,x(a(R)(s.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1}),!a(m)&&(!a(c)||a(c).length===0)?(k(),j("div",Ot,[t(T,{name:"outlet",style:{"font-size":"3rem"}}),Pt])):V("",!0)]),_:1},8,["thumb-style","bar-style"])])])}}}),Kt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Gt=g(" \u65E5\u5E38\u5468\u671F\u6027\u5B9A\u65F6\u6267\u884C\u7684\u4EFB\u52A1 "),Mt=g(" \u6307\u5B9A\u65F6\u95F4\u8C03\u5EA6\u4E00\u6B21\u7684\u4EFB\u52A1 "),Zt=g(" \u7528\u4E8E\u4EFB\u52A1\u7F16\u6392\u7684\u5B50\u4EFB\u52A1 "),we=D({props:{projectId:{type:Number,required:!0}},setup(v){const o=v,e=N(),m=E(()=>e.name&&!["crontab_tasks","workflow_tasks","temporary_tasks"].includes(e.name.toString())),b=E(()=>{var _;if(e.name){const c=e.name.toString();if(c.search("crontab")>=0)return"normal";if(c.search("workflow")>=0)return"workflow";if(c.search("temporary")>=0)return"temporary"}throw new Error(`Unknown route name ${(_=e.name)==null?void 0:_.toString()}`)});return(_,c)=>{const p=L("router-view");return k(),j(q,null,[l("div",{class:S("xl:tw-basis-1/5 tw-basis-1/4 tw-w-full tw-h-full tw-bg-[#1E1E1E] tw-min-w-[280px]"+(a(m)?" tw-hidden lg:tw-block":""))},[l("div",Kt,[t(dt,{"model-value":a(b),"active-color":"primary"},{default:n(()=>[t(O,{name:"crontab",label:"\u666E\u901A",to:{name:"crontab_tasks",params:{projectId:o.projectId}},replace:""},{default:n(()=>[t(z,{class:"bg-warning tw-text-black",offset:[10,10]},{default:n(()=>[Gt]),_:1})]),_:1},8,["to"]),t(O,{name:"temporary",label:"\u4E34\u65F6",to:{name:"temporary_tasks",params:{projectId:o.projectId}},replace:""},{default:n(()=>[t(z,{class:"bg-warning tw-text-black",offset:[10,10]},{default:n(()=>[Mt]),_:1})]),_:1},8,["to"]),t(O,{name:"workflow",label:"\u4EFB\u52A1\u6D41",to:{name:"workflow_tasks",params:{projectId:o.projectId}},replace:""},{default:n(()=>[t(z,{class:"bg-warning tw-text-black",offset:[10,10]},{default:n(()=>[Zt]),_:1})]),_:1},8,["to"])]),_:1},8,["model-value"]),t(wt,{"model-value":a(b),animated:"",class:"tw-w-full tw-grow"},{default:n(()=>[t(P,{name:"normal",class:"tw-p-0"},{default:n(()=>[t(It,{"project-id":o.projectId},null,8,["project-id"])]),_:1}),t(P,{name:"temporary",class:"tw-p-0"},{default:n(()=>[t(Rt,{"project-id":o.projectId},null,8,["project-id"])]),_:1}),t(P,{name:"workflow",class:"tw-p-0"},{default:n(()=>[t(Wt,{"project-id":o.projectId},null,8,["project-id"])]),_:1})]),_:1},8,["model-value"])])],2),l("div",{class:S("xl:tw-basis-3/5 tw-basis-1/2 tw-h-full tw-w-full"+(a(m)?"":" tw-hidden lg:tw-block"))},[t(p)],2)],64)}}});export{we as default};

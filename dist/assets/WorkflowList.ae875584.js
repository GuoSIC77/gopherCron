var ee=Object.defineProperty;var R=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var q=(i,n,e)=>n in i?ee(i,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[n]=e,L=(i,n)=>{for(var e in n||(n={}))te.call(n,e)&&q(i,e,n[e]);if(R)for(var e of R(n))oe.call(n,e)&&q(i,e,n[e]);return i};import{_ as U,k as E,l as I,J as le,u as J,r as k,o as v,c as b,A as c,E as K,I as $,w as u,a as l,Q as z,K as V,a8 as Y,az as ae,d as y,t as C,Y as N,D as se,f as re,h as Q,i as ne,F as ue,b as g,aA as ie,aB as de,aC as we,al as G,x as M,C as T,T as P,U as j,ac as S,S as H,au as ce,H as O,m as fe,aD as me,ag as X,aq as pe,a2 as A,q as D,aj as ve,ay as _e,p as B,a4 as ge}from"./index.a78b90e1.js";import{C as Z}from"./Confirm.356f7c34.js";import{f as ke}from"./datetime.561112b0.js";import{t as he,b as ye}from"./thumbStyle.856de4cb.js";const be=E({props:{workflowId:{type:Number,required:!0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(i,{emit:n}){const e=i,d=I({get:()=>e.modelValue,set:p=>n("update:modelValue",p)}),_=le(),m=J(),a=I(()=>m.state.WorkFlow.workflows.get(e.workflowId)),o=k(!1);async function W(p){o.value=!0;try{m.commit("cleanError"),await m.dispatch("WorkFlow/deleteWorkFlow",{id:p}),m.state.Root.currentError===void 0&&(_.push({name:"workflows"}),d.value=!1)}catch(w){console.error(w),m.commit("error",{error:w})}o.value=!1}return(p,w)=>{var x;return v(),b(Z,{modelValue:c(d),"onUpdate:modelValue":w[0]||(w[0]=F=>K(d)?d.value=F:null),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1\u7F16\u6392 "+((x=c(a))==null?void 0:x.title)+" ?",type:"warning",loading:o.value,onConfirm:w[1]||(w[1]=F=>c(a)&&W(c(a).id))},null,8,["modelValue","content","loading"])}}});var xe=U(be,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/DialogWorkFlowDeleteConfirm.vue"]]);const Fe=g("div",{class:"text-h6"},"\u4EFB\u52A1\u7F16\u6392\u4EBA\u5458\u7BA1\u7406",-1),Ce=y(" \u6DFB\u52A0 "),Ve=E({props:{workflowId:{type:Number,default:0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(i,{emit:n}){const e=i,d=I({get:()=>e.modelValue,set:s=>n("update:modelValue",s)}),_=k([]);async function m(){_.value=await ie(e.workflowId)}$(()=>[e.workflowId,d.value],async([,s])=>{s&&m(),a.value=""});const a=k(""),o=k(!1);async function W(){o.value=!0;try{await de(e.workflowId,a.value),a.value="",await m()}finally{o.value=!1}}const p=k(),w=k(!1);function x(s){p.value=s,w.value=!0}function F(){p.value=void 0,w.value=!1}async function t(s){o.value=!0;try{await we(e.workflowId,s.id),await m()}finally{o.value=!1}}return(s,f)=>(v(),b(ue,{modelValue:c(d),"onUpdate:modelValue":f[3]||(f[3]=r=>K(d)?d.value=r:null)},{default:u(()=>{var r;return[l(Z,{modelValue:w.value,"onUpdate:modelValue":f[0]||(f[0]=h=>w.value=h),type:"warning",content:`\u786E\u5B9A\u8981\u79FB\u9664\u7528\u6237 ${(r=p.value)==null?void 0:r.name} \u5417\uFF1F`,onConfirm:f[1]||(f[1]=h=>p.value&&t(p.value).then(F))},null,8,["modelValue","content"]),l(ne,{class:"tw-w-96 q-pa-sm"},{default:u(()=>[l(z,null,{default:u(()=>[Fe]),_:1}),l(z,null,{default:u(()=>[(v(!0),V(N,null,Y(_.value,h=>(v(),b(ae,{key:h.id,removable:"",color:"primary","text-color":"black",onRemove:Je=>x(h)},{default:u(()=>[y(C(h.name),1)]),_:2},1032,["onRemove"]))),128))]),_:1}),l(se,null,{default:u(()=>[l(re,{modelValue:a.value,"onUpdate:modelValue":f[2]||(f[2]=h=>a.value=h),class:"tw-w-full",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u5E10\u53F7"},{append:u(()=>[l(Q,{loading:o.value,flat:"",icon:"add","text-color":"primary",onClick:W},{default:u(()=>[Ce]),_:1},8,["loading"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]}),_:1},8,["modelValue"]))}});var Ie=U(Ve,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/DialogWorkFlowUsersManage.vue"]]);const We=y("\u4EBA\u5458\u7BA1\u7406"),Ue=y("\u5220\u9664"),Ee=E({props:{workflowId:{type:Number,required:!0}},setup(i){const n=i,e=k(!1),d=k(!1),_=k(!1);return(m,a)=>(v(),V(N,null,[l(xe,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=o=>d.value=o),"workflow-id":n.workflowId},null,8,["modelValue","workflow-id"]),l(Ie,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=o=>_.value=o),"workflow-id":n.workflowId},null,8,["modelValue","workflow-id"]),l(ce,{modelValue:e.value,"onUpdate:modelValue":a[4]||(a[4]=o=>e.value=o),dense:"",flat:"","dropdown-icon":"more_horiz","no-icon-animation":"",onClick:a[5]||(a[5]=S(()=>{},["stop","prevent"]))},{default:u(()=>[l(G,{dense:""},{default:u(()=>[M((v(),b(H,{clickable:"",class:"hover:tw-bg-primary hover:tw-text-black",onClick:a[2]||(a[2]=S(o=>_.value=!0,["stop"]))},{default:u(()=>[l(P,null,{default:u(()=>[l(j,null,{default:u(()=>[We]),_:1})]),_:1})]),_:1})),[[T,!0]]),M((v(),b(H,{clickable:"",class:"hover:tw-bg-primary hover:tw-text-black",onClick:a[3]||(a[3]=S(o=>d.value=!0,["stop"]))},{default:u(()=>[l(P,null,{default:u(()=>[l(j,null,{default:u(()=>[Ue]),_:1})]),_:1})]),_:1})),[[T,!0]])]),_:1})]),_:1},8,["modelValue"])],64))}});var Be=U(Ee,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/DropdownWorkFlowManage.vue"]]);const Se={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},De={class:"q-pa-md tw-flex tw-flex-row-reverse tw-gap-4"},$e={class:"tw-w-full tw-grow tw-overflow-hidden tw-min-w-[280px]"},Qe={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},Ae={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},Ne={class:"task__remark"},Re={class:"task__bottom-box"},qe={class:"task__bottom-time"},Le={key:1,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},ze=y(" \u6682\u65E0\u6570\u636E "),Me=E({props:{orgId:{type:String,required:!0}},setup(i){const n=i,e=J(),d=O(),_=k(),m=I(()=>e.state.WorkFlow.loadingWorkflows);e.commit("WorkFlow/clearWorkFlows"),$(()=>d.name,t=>{(t==null?void 0:t.toString())==="workflows"&&w()});function a(t){const s=_.value;if(s===void 0)throw new Error("scroll-area instance is missing");if(!o.value)return;const f=o.value.findIndex(r=>r.id===t);setTimeout(()=>{if(f<0)s.setScrollPercentage("vertical",0);else{const r=1*f/o.value.length*s.getScroll().verticalSize-50;s.setScrollPosition("vertical",r)}},100)}fe(async()=>{e.watch(t=>[t.Root.eventWorkFlow],([t])=>{if(!t)return;const s=e.state.WorkFlow.workflows.get(t.workFlowId);s!==void 0&&e.commit("notifySuccess",{message:`\u4EFB\u52A1\u7F16\u6392 ${s.title} \u5F53\u524D\u72B6\u6001: ${t.status}`}),w()}),$(()=>[o.value],()=>{const t=Number(d.params.workflowId);t!==0&&!isNaN(t)&&a(t)},{deep:!0}),w()});const o=I(()=>{const t=e.state.WorkFlow.workflows,s=Array.from(t.values());return s.sort((f,r)=>r.id-f.id),s});async function W(t,s){if(t===1)return;p.page=t,(await w()).length<p.pageSize?s(!0):s(!1)}const p=me({page:1,pageSize:15});async function w(){const[t]=await e.dispatch("WorkFlow/fetchWorkFlows",L({orgId:n.orgId},p));return t}function x(t){return t.id===Number(d.params.workflowId||0)}function F(t){return t.state&&t.state.status==="running"}return(t,s)=>{const f=X("router-link");return v(),V("div",Se,[g("div",De,[l(Q,{flat:"",loading:c(m),icon:"refresh",onClick:w},null,8,["loading"]),l(Q,{flat:"",icon:"add",to:{name:"create_workflow"}})]),g("div",$e,[l(c(ge),{ref_key:"scrollArea",ref:_,visible:"","thumb-style":c(he),"bar-style":c(ye),class:"tw-w-full tw-h-full tw-px-[15px]"},{default:u(()=>[l(c(pe),{class:"tw-w-full tw-h-full",offset:100,onLoad:W},{default:u(()=>[c(o)&&c(o).length>0?(v(),b(G,{key:0,class:"tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:u(()=>[(v(!0),V(N,null,Y(c(o),r=>(v(),b(f,{key:r.id,to:{name:"workflow",params:{workflowId:r.id}}},{default:u(()=>[g("div",{class:A((x(r)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-lg tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[g("div",Qe,[g("div",Ae,[l(D,{name:"schedule",class:"tw-inline"}),y(" "+C(r.cronExpr),1)]),l(ve),l(_e,{outline:"",color:r.status===1?"green":"red",class:"tw-w-[50px]"},{default:u(()=>[y(C(F(r)?"\u6267\u884C\u4E2D":r.status==1?"\u8C03\u5EA6\u4E2D":"\u5DF2\u6682\u505C"),1)]),_:2},1032,["color"]),B(` <div :class="'tw-w-[50px] task__status' + task.status"></div> `)]),g("div",{class:A((x(r)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[l(D,{name:"numbers"}),y(" "+C(r.title),1)],2),g("div",Ne,C(r.remark||"-"),1),g("div",Re,[g("div",qe,C(c(ke)(r.createTime*1e3)),1),l(Be,{"workflow-id":r.id},null,8,["workflow-id"])])],2)]),_:2},1032,["to"]))),128))]),_:1})):B("v-if",!0),!c(m)&&(!c(o)||c(o).length===0)?(v(),V("div",Le,[l(D,{name:"outlet",style:{"font-size":"3rem"}}),ze])):B("v-if",!0)]),_:1})]),_:1},8,["thumb-style","bar-style"])])])}}});var Te=U(Me,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/WorkFlowList.vue"]]);const Pe={class:"lg:q-pa-md tw-box-border tw-flex tw-flex-row tw-gap-4 tw-h-full tw-w-full"},je={class:"tw-w-full tw-h-full tw-grow tw-overflow-hidden"},He=E({props:{orgId:{type:String,required:!0}},setup(i){const n=O(),e=I(()=>n.name&&n.name.toString()!=="workflows"?"tw-hidden lg:tw-block":"");return(d,_)=>{const m=X("router-view");return v(),V("div",Pe,[g("div",{class:A("xl:tw-basis-1/5 lg:tw-basis-1/4  tw-h-full tw-w-full tw-shrink-0 "+c(e))},[i.orgId?(v(),b(Te,{key:0,"org-id":i.orgId},null,8,["org-id"])):B("v-if",!0)],2),g("div",je,[l(m)])])}}});var Ze=U(He,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/pages/WorkflowList.vue"]]);export{Ze as default};

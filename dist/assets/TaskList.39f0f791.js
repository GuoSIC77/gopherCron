var at=Object.defineProperty;var H=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable;var K=(m,l,s)=>l in m?at(m,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[l]=s,F=(m,l)=>{for(var s in l||(l={}))st.call(l,s)&&K(m,s,l[s]);if(H)for(var s of H(l))ot.call(l,s)&&K(m,s,l[s]);return m};import{Q as lt,b as rt,a as R,c as q}from"./QTabPanels.f701a35a.js";import{Q as nt}from"./QTooltip.5d526b09.js";import{cz as X,j as V,u as L,c as h,o as z,k as U,r as B,B as Y,bp as A,l as _,E as y,s as e,z as a,x as n,q as u,y as b,Q as E,J as D,N as O,m as C,aI as T,F as x,I as k,t as Q,D as N}from"./index.858abf03.js";import{Q as W}from"./QInput.39515e5e.js";import{Q as Z,a as tt}from"./QBadge.aa8875bd.js";import{Q as P}from"./QList.53c0d763.js";import{Q as J}from"./QScrollArea.ce37051a.js";import{_ as et}from"./Confirm.200ef114.js";import{f as S}from"./datetime.6205e5a7.js";import{t as M,b as G}from"./thumbStyle.856de4cb.js";import"./uid.42677368.js";import"./touch.9357bf86.js";import"./use-prevent-scroll.a5760f87.js";import"./focus-manager.2ec597e1.js";import"./rtl.b51694b1.js";import"./use-key-composition.89abe8dc.js";import"./format.865294d5.js";import"./QDialog.eb528cda.js";import"./ClosePopup.411262dd.js";const ut={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},it={class:"q-pa-md tw-flex tw-justify-around"},ct={class:"tw-w-full tw-grow"},dt={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},wt={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},mt={class:"task__remark"},pt={class:"task__bottom-box"},ft={class:"task__bottom-time"},_t={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},vt=x(" \u6682\u65E0\u6570\u636E "),kt=V({props:{projectId:{type:Number,required:!0}},setup(m){const l=m,s=L(),c=h(()=>s.state.Task.loadingTasks);z(()=>{U(async()=>{s.dispatch("subscribeTopic",["/task/status/project/"+l.projectId]),await p()}),s.watch(t=>[t.Root.eventTask],([t])=>{if(!t||t.projectId!==l.projectId)return;const o=i.value.find(I=>I.id===t.taskId);o!==void 0&&s.commit("notifySuccess",{message:`\u4EFB\u52A1 ${o.name} \u5F53\u524D\u72B6\u6001: ${t.status}`}),p()})});async function p(){await s.dispatch("Task/fetchTasks",F({},l))}const d=B(""),i=h(()=>{var t;return((t=s.state.Task.tasks.get(l.projectId))==null?void 0:t.filter(o=>o.name.indexOf(d.value)>=0||o.id.toString().indexOf(d.value)>=0))||[]});function v(t){return N().params.taskId===t.id}const f=h(()=>i.value.filter(v).pop()),g=Y(),w=B(!1);async function j(t,o){s.commit("cleanError"),await s.dispatch("deleteTask",{projectId:t,taskId:o}),s.state.Root.currentError===void 0&&(g.push({name:"crontab_tasks",params:{projectId:t}}),w.value=!1,await p())}return(t,o)=>{var $;const I=A("router-link");return _(),y("div",ut,[e(et,{modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=r=>w.value=r),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1"+(($=a(f))==null?void 0:$.name)+"?",type:"warning",onConfirm:o[1]||(o[1]=r=>a(f)&&j(a(f).projectId,a(f).id))},null,8,["modelValue","content"]),n("div",it,[e(W,{modelValue:d.value,"onUpdate:modelValue":o[2]||(o[2]=r=>d.value=r),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:u(()=>[e(b,{name:"search"})]),_:1},8,["modelValue"]),e(E,{flat:"",dense:"",loading:a(c),icon:"refresh",onClick:p},null,8,["loading"]),e(E,{flat:"",dense:"",to:{name:"create_crontab_task"},icon:"add"}),e(E,{flat:"",dense:"",class:"tw-text-red-300 lg:tw-flex tw-hidden",icon:"delete",disable:!a(f),onClick:o[3]||(o[3]=r=>w.value=!0)},null,8,["disable"])]),n("div",ct,[e(J,{class:"tw-w-full tw-h-full tw-px-[15px]",visible:"","thumb-style":a(M),"bar-style":a(G)},{default:u(()=>[e(P,{class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4 tw-overflow-hidden tw-relative"},{default:u(()=>[(_(!0),y(D,null,O(a(i),r=>(_(),C(I,{key:r.id,to:{name:"crontab_task",params:{taskId:r.id}}},{default:u(()=>[n("div",{class:T((v(r)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[n("div",dt,[n("div",wt,[e(b,{name:"schedule",class:"tw-inline"}),x(" "+k(r.cronExpr),1)]),e(Z),e(tt,{outline:"",color:r.status===1?"green":"red",class:"tw-w-[50px]"},{default:u(()=>[x(k(r.isRunning==1?"\u6267\u884C\u4E2D":r.status==1?"\u8C03\u5EA6\u4E2D":"\u5DF2\u7EC8\u6B62"),1)]),_:2},1032,["color"])]),n("div",{class:T((v(r)?"active ":"")+"task__title tw-flex-col tw-items-center tw-w-full")},[e(b,{name:"numbers"}),x(" "+k(r.name),1)],2),n("div",mt,k(r.remark||"-"),1),n("div",pt,[n("div",ft,k(a(S)(r.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1}),!a(c)&&(!a(i)||a(i).length===0)?(_(),y("div",_t,[e(b,{name:"outlet",style:{"font-size":"3rem"}}),vt])):Q("",!0)]),_:1},8,["thumb-style","bar-style"])])])}}});var bt=X(kt,[["__scopeId","data-v-70a53bab"]]);const ht={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},xt={class:"q-pa-md tw-flex tw-justify-around"},yt={class:"tw-w-full tw-grow"},gt={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},Tt={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},It={class:"task__remark"},Et={class:"task__bottom-box"},jt={class:"task__bottom-time"},$t={key:1,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},Ft=x(" \u6682\u65E0\u6570\u636E "),Bt=V({props:{projectId:{type:Number,required:!0}},setup(m){const l=m,s=B(""),c=L(),p=h(()=>c.state.Task.loadingTasks);async function d(){await c.dispatch("Task/fetchTasks",F({},l)),await c.dispatch("Task/fetchTemporaryTasks",F({},l))}z(async()=>{U(async()=>{await d()}),c.state.Task.tasks||await c.dispatch("Task/fetchTasks",{projectId:l.projectId})});const i=h(()=>c.state.Task.tasks.get(l.projectId)),v=h(()=>{var g;return((g=c.state.Task.temporaryTasks.get(l.projectId))==null?void 0:g.filter(w=>w.taskId.toString().indexOf(s.value)>=0))||[]});function f(g){const w=N();return Number(w.params.taskId)===g.id}return(g,w)=>{const j=A("router-link");return _(),y("div",ht,[n("div",xt,[e(W,{modelValue:s.value,"onUpdate:modelValue":w[0]||(w[0]=t=>s.value=t),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:u(()=>[e(b,{name:"search"})]),_:1},8,["modelValue"]),e(E,{flat:"",dense:"",loading:a(p),icon:"refresh",onClick:d},null,8,["loading"])]),n("div",yt,[e(J,{class:"tw-w-full tw-h-full tw-px-[15px]",visible:"","thumb-style":a(M),"bar-style":a(G)},{default:u(()=>[a(i)?(_(),C(P,{key:0,class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:u(()=>[(_(!0),y(D,null,O(a(v),t=>(_(),C(j,{key:t.id,to:{name:"temporary_task",params:{taskId:t.id}}},{default:u(()=>[n("div",{class:T((f(t)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[n("div",gt,[n("div",Tt,[e(b,{name:"schedule",class:"tw-inline"}),x(" "+k(a(S)(t.scheduleTime*1e3)),1)]),e(Z),e(tt,{outline:"",color:t.scheduleStatus===1?"green":"red",class:"tw-w-[50px]"},{default:u(()=>[x(k(t.isRunning==1?"\u6267\u884C\u4E2D":t.scheduleStatus==1?"\u7B49\u5F85\u4E2D":"\u5DF2\u5B8C\u6210"),1)]),_:2},1032,["color"])]),n("div",{class:T((f(t)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[e(b,{name:"numbers"}),x(" "+k(t.remark),1)],2),n("div",It,"\u521B\u5EFA\u4EBA\uFF1A"+k(t.userName||"-"),1),n("div",Et,[n("div",jt,k(a(S)(t.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1})):Q("",!0),!a(p)&&(!a(v)||a(v).length===0)?(_(),y("div",$t,[e(b,{name:"outlet",style:{"font-size":"3rem"}}),Ft])):Q("",!0)]),_:1},8,["thumb-style","bar-style"])])])}}});var Ct=X(Bt,[["__scopeId","data-v-0ba1ef0c"]]);const Qt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},St={class:"q-pa-md tw-flex tw-justify-around"},Vt={class:"tw-w-full tw-grow"},At={class:"task__remark"},Dt={class:"task__bottom-box"},Nt={class:"task__bottom-time"},Rt={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},qt=x(" \u6682\u65E0\u6570\u636E "),Lt=V({props:{projectId:{type:Number,required:!0}},setup(m){const l=m,s=L(),c=h(()=>s.state.WorkFlowTask.loadingTasks);z(()=>{U(async()=>{await p()}),s.watch(t=>[t.Root.eventWorkFlowTask],([t])=>{if(!t||t.projectId!==l.projectId)return;const o=i.value.find(I=>I.id===t.taskId);o!==void 0&&s.commit("notifySuccess",{message:`\u4EFB\u52A1 ${o.name} \u5F53\u524D\u72B6\u6001: ${t.status}`}),p()})});async function p(){await s.dispatch("WorkFlowTask/fetchTasks",F({},l))}const d=B(""),i=h(()=>{var t;return((t=s.state.WorkFlowTask.tasks.get(l.projectId))==null?void 0:t.filter(o=>o.name.indexOf(d.value)>=0||o.id.toString().indexOf(d.value)>=0))||[]});function v(t){return N().params.taskId===t.id}const f=h(()=>i.value.filter(v).pop()),g=Y(),w=B(!1);async function j(t,o){s.commit("cleanError"),await s.dispatch("deleteWorkFlowTask",{projectId:t,taskId:o}),s.state.Root.currentError===void 0&&(g.push({name:"workflow_tasks",params:{projectId:t}}),w.value=!1,await p())}return(t,o)=>{var $;const I=A("router-link");return _(),y("div",Qt,[e(et,{modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=r=>w.value=r),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1"+(($=a(f))==null?void 0:$.name)+"?",type:"warning",onConfirm:o[1]||(o[1]=r=>a(f)&&j(a(f).projectId,a(f).id))},null,8,["modelValue","content"]),n("div",St,[e(W,{modelValue:d.value,"onUpdate:modelValue":o[2]||(o[2]=r=>d.value=r),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:u(()=>[e(b,{name:"search"})]),_:1},8,["modelValue"]),e(E,{flat:"",dense:"",loading:a(c),icon:"refresh",onClick:p},null,8,["loading"]),e(E,{flat:"",dense:"",to:{name:"create_workflow_task"},icon:"add"}),e(E,{flat:"",dense:"",class:"tw-text-red-300 lg:tw-flex tw-hidden",icon:"delete",disable:!a(f),onClick:o[3]||(o[3]=r=>w.value=!0)},null,8,["disable"])]),n("div",Vt,[e(J,{class:"tw-h-full tw-w-full tw-px-[15px]",visible:"","thumb-style":a(M),"bar-style":a(G)},{default:u(()=>[e(P,{class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:u(()=>[(_(!0),y(D,null,O(a(i),r=>(_(),C(I,{key:r.id,to:{name:"workflow_task",params:{taskId:r.id}}},{default:u(()=>[n("div",{class:T((v(r)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-py-3 tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[n("div",{class:T((v(r)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[e(b,{name:"numbers"}),x(" "+k(r.name),1)],2),n("div",At,k(r.remark||"-"),1),n("div",Dt,[n("div",Nt,k(a(S)(r.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1}),!a(c)&&(!a(i)||a(i).length===0)?(_(),y("div",Rt,[e(b,{name:"outlet",style:{"font-size":"3rem"}}),qt])):Q("",!0)]),_:1},8,["thumb-style","bar-style"])])])}}}),zt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Ut=x(" \u6307\u5B9A\u65F6\u95F4\u8C03\u5EA6\u4E00\u6B21\u7684\u4EFB\u52A1 "),ie=V({props:{projectId:{type:Number,required:!0}},setup(m){const l=m,s=N(),c=h(()=>s.name&&!["crontab_tasks","workflow_tasks","temporary_tasks"].includes(s.name.toString())),p=h(()=>{var d;if(s.name){const i=s.name.toString();if(i.search("crontab")>=0)return"normal";if(i.search("workflow")>=0)return"workflow";if(i.search("temporary")>=0)return"temporary"}throw new Error(`Unknown route name ${(d=s.name)==null?void 0:d.toString()}`)});return(d,i)=>{const v=A("router-view");return _(),y(D,null,[n("div",{class:T("xl:tw-basis-1/5 tw-basis-1/4 tw-w-full tw-h-full tw-bg-[#1E1E1E] tw-min-w-[280px]"+(a(c)?" tw-hidden lg:tw-block":""))},[n("div",zt,[e(lt,{"model-value":a(p),"active-color":"primary"},{default:u(()=>[e(R,{name:"crontab",label:"\u666E\u901A",to:{name:"crontab_tasks",params:{projectId:l.projectId}},replace:""},null,8,["to"]),e(R,{name:"temporary",label:"\u4E34\u65F6",to:{name:"temporary_tasks",params:{projectId:l.projectId}},replace:""},{default:u(()=>[e(nt,{class:"bg-warning tw-text-black",offset:[10,10]},{default:u(()=>[Ut]),_:1})]),_:1},8,["to"]),e(R,{name:"workflow",label:"\u4EFB\u52A1\u6D41",to:{name:"workflow_tasks",params:{projectId:l.projectId}},replace:""},null,8,["to"])]),_:1},8,["model-value"]),e(rt,{"model-value":a(p),animated:"",class:"tw-w-full tw-grow"},{default:u(()=>[e(q,{name:"normal",class:"tw-p-0"},{default:u(()=>[e(bt,{"project-id":l.projectId},null,8,["project-id"])]),_:1}),e(q,{name:"temporary",class:"tw-p-0"},{default:u(()=>[e(Ct,{"project-id":l.projectId},null,8,["project-id"])]),_:1}),e(q,{name:"workflow",class:"tw-p-0"},{default:u(()=>[e(Lt,{"project-id":l.projectId},null,8,["project-id"])]),_:1})]),_:1},8,["model-value"])])],2),n("div",{class:T("xl:tw-basis-3/5 tw-basis-1/2 tw-h-full tw-w-full"+(a(c)?"":" tw-hidden lg:tw-block"))},[e(v)],2)],64)}}});export{ie as default};

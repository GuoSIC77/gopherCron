var _e=Object.defineProperty;var J=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var Y=(o,r,a)=>r in o?_e(o,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[r]=a,G=(o,r)=>{for(var a in r||(r={}))he.call(r,a)&&Y(o,a,r[a]);if(J)for(var a of J(r))ke.call(r,a)&&Y(o,a,r[a]);return o};import{a as be,r as _,c as S,w as V,a5 as ye,a4 as xe,U as Fe,o as ne,ax as Ce,h as K,b as Ve,ag as Ee,a$ as X,n as Z,aj as Se,g as Be,_ as W,j as A,B as Ie,u as ue,l as y,m as U,z as p,A as ie,q as f,s as i,E as Q,N as de,F as E,I,J as O,Q as H,x as b,b0 as Qe,b1 as Ue,b2 as De,f as ee,aW as M,D as ce,aR as We,aS as fe,aY as j,y as P,t as te}from"./index.8ec00635.js";import{Q as Ae,a as $e}from"./QBadge.b15bd9c0.js";import{Q as we}from"./QList.58a4b5dd.js";import{t as $,b as q,d as z,g as Ne}from"./use-prevent-scroll.c821079a.js";import{Q as Le}from"./QScrollArea.ffe2066c.js";import{a as oe,b as le,Q as ae}from"./QItem.fd731537.js";import{Q as Re}from"./QBtnDropdown.7cb8e38c.js";import{Q as Te,C as se}from"./ClosePopup.229815c6.js";import{C as me}from"./Confirm.388454a6.js";import{a as re,b as Me,Q as Pe}from"./QDialog.fd4f138b.js";import{a as qe}from"./QChip.7657ac17.js";import{Q as ze}from"./QInput.18ea454a.js";import{f as He}from"./datetime.6205e5a7.js";import{t as je,b as Oe}from"./thumbStyle.856de4cb.js";import"./focus-manager.5de30bde.js";import"./touch.8160dcd9.js";import"./format.865294d5.js";import"./uid.42677368.js";import"./use-key-composition.3f5e825f.js";const{passive:B}=Ee;var Je=be({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:{default:void 0},initialIndex:Number,disable:Boolean,reverse:Boolean},emits:["load"],setup(o,{slots:r,emit:a}){const n=_(!1),d=_(!0),m=_(null),t=_(null);let c=o.initialIndex||0,e,s;const h=S(()=>"q-infinite-scroll__loading"+(n.value===!0?"":" invisible"));function k(){if(o.disable===!0||n.value===!0||d.value===!1)return;const w=$(e),F=q(e),D=X(e);o.reverse===!1?Math.round(F+D+o.offset)>=Math.round(w)&&l():Math.round(F)<=o.offset&&l()}function l(){if(o.disable===!0||n.value===!0||d.value===!1)return;c++,n.value=!0;const w=$(e);a("load",c,F=>{d.value===!0&&(n.value=!1,Z(()=>{if(o.reverse===!0){const D=$(e),pe=q(e),ge=D-w;z(e,pe+ge)}F===!0?u():m.value&&m.value.closest("body")&&s()}))})}function g(){c=0}function v(){d.value===!1&&(d.value=!0,e.addEventListener("scroll",s,B)),k()}function u(){d.value===!0&&(d.value=!1,n.value=!1,e.removeEventListener("scroll",s,B),s!==void 0&&s.cancel!==void 0&&s.cancel())}function x(){if(e&&d.value===!0&&e.removeEventListener("scroll",s,B),e=Ne(m.value,o.scrollTarget),d.value===!0){if(e.addEventListener("scroll",s,B),o.reverse===!0){const w=$(e),F=X(e);z(e,w-F)}k()}}function C(w){c=w}function N(w){w=parseInt(w,10);const F=s;s=w<=0?k:Se(k,isNaN(w)===!0?100:w),e&&d.value===!0&&(F!==void 0&&e.removeEventListener("scroll",F,B),e.addEventListener("scroll",s,B))}function L(w){if(R.value===!0){if(t.value===null){w!==!0&&Z(()=>{L(!0)});return}const F=`${n.value===!0?"un":""}pauseAnimations`;Array.from(t.value.getElementsByTagName("svg")).forEach(D=>{D[F]()})}}const R=S(()=>o.disable!==!0&&d.value===!0);V([n,R],()=>{L()}),V(()=>o.disable,w=>{w===!0?u():v()}),V(()=>o.reverse,()=>{n.value===!1&&d.value===!0&&k()}),V(()=>o.scrollTarget,x),V(()=>o.debounce,N);let T=!1;ye(()=>{T!==!1&&e&&z(e,T)}),xe(()=>{T=e?q(e):!1}),Fe(()=>{d.value===!0&&e.removeEventListener("scroll",s,B)}),ne(()=>{N(o.debounce),x(),n.value===!1&&L()});const ve=Be();return Object.assign(ve.proxy,{poll:()=>{s!==void 0&&s()},trigger:l,stop:u,reset:g,resume:v,setIndex:C}),()=>{const w=Ce(r.default,[]);return R.value===!0&&w[o.reverse===!1?"push":"unshift"](K("div",{ref:t,class:h.value},Ve(r.loading))),K("div",{class:"q-infinite-scroll",ref:m},w)}}});const Ye=A({props:{workflowId:{type:Number,required:!0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{emit:r}){const a=o,n=S({get:()=>a.modelValue,set:e=>r("update:modelValue",e)}),d=Ie(),m=ue(),t=S(()=>m.state.WorkFlow.workflows.get(a.workflowId));async function c(e){m.commit("cleanError"),await m.dispatch("WorkFlow/deleteWorkFlow",{id:e}),m.state.Root.currentError===void 0&&(d.push({name:"workflows"}),n.value=!1)}return(e,s)=>{var h;return y(),U(me,{modelValue:p(n),"onUpdate:modelValue":s[0]||(s[0]=k=>ie(n)?n.value=k:null),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1\u7F16\u6392 "+((h=p(t))==null?void 0:h.title)+" ?",type:"warning",onConfirm:s[1]||(s[1]=k=>p(t)&&c(p(t).id))},null,8,["modelValue","content"])}}});var Ge=W(Ye,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/DialogWorkFlowDeleteConfirm.vue"]]);const Ke=b("div",{class:"text-h6"},"\u4EFB\u52A1\u7F16\u6392\u4EBA\u5458\u7BA1\u7406",-1),Xe=E(" \u6DFB\u52A0 "),Ze=A({props:{workflowId:{type:Number,default:0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(o,{emit:r}){const a=o,n=S({get:()=>a.modelValue,set:v=>r("update:modelValue",v)}),d=_([]);async function m(){d.value=await Qe(a.workflowId)}V(()=>[a.workflowId,n.value],async([,v])=>{v&&m(),t.value=""});const t=_(""),c=_(!1);async function e(){c.value=!0;try{await Ue(a.workflowId,t.value),t.value="",await m()}finally{c.value=!1}}const s=_(),h=_(!1);function k(v){s.value=v,h.value=!0}function l(){s.value=void 0,h.value=!1}async function g(v){c.value=!0;try{await De(a.workflowId,v.id),await m()}finally{c.value=!1}}return(v,u)=>(y(),U(Pe,{modelValue:p(n),"onUpdate:modelValue":u[3]||(u[3]=x=>ie(n)?n.value=x:null)},{default:f(()=>{var x;return[i(me,{modelValue:h.value,"onUpdate:modelValue":u[0]||(u[0]=C=>h.value=C),type:"warning",content:`\u786E\u5B9A\u8981\u79FB\u9664\u7528\u6237 ${(x=s.value)==null?void 0:x.name} \u5417\uFF1F`,onConfirm:u[1]||(u[1]=C=>s.value&&g(s.value).then(l))},null,8,["modelValue","content"]),i(Me,{class:"tw-w-96 q-pa-sm"},{default:f(()=>[i(re,null,{default:f(()=>[Ke]),_:1}),i(re,null,{default:f(()=>[(y(!0),Q(O,null,de(d.value,C=>(y(),U(qe,{key:C.id,removable:"",color:"primary","text-color":"black",onRemove:N=>k(C)},{default:f(()=>[E(I(C.name),1)]),_:2},1032,["onRemove"]))),128))]),_:1}),i(Te,null,{default:f(()=>[i(ze,{modelValue:t.value,"onUpdate:modelValue":u[2]||(u[2]=C=>t.value=C),class:"tw-w-full",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u5E10\u53F7"},{append:f(()=>[i(H,{loading:c.value,flat:"",icon:"add","text-color":"primary",onClick:e},{default:f(()=>[Xe]),_:1},8,["loading"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]}),_:1},8,["modelValue"]))}});var et=W(Ze,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/DialogWorkFlowUsersManage.vue"]]);const tt=E("\u4EBA\u5458\u7BA1\u7406"),ot=E("\u5220\u9664"),lt=A({props:{workflowId:{type:Number,required:!0}},setup(o){const r=o,a=_(!1),n=_(!1),d=_(!1);return(m,t)=>(y(),Q(O,null,[i(Ge,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=c=>n.value=c),"workflow-id":r.workflowId},null,8,["modelValue","workflow-id"]),i(et,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=c=>d.value=c),"workflow-id":r.workflowId},null,8,["modelValue","workflow-id"]),i(Re,{modelValue:a.value,"onUpdate:modelValue":t[4]||(t[4]=c=>a.value=c),dense:"",flat:"","dropdown-icon":"more_horiz","no-icon-animation":"",onClick:t[5]||(t[5]=M(()=>{},["stop","prevent"]))},{default:f(()=>[i(we,{dense:""},{default:f(()=>[ee((y(),U(ae,{clickable:"",class:"hover:tw-bg-primary hover:tw-text-black",onClick:t[2]||(t[2]=M(c=>d.value=!0,["stop"]))},{default:f(()=>[i(oe,null,{default:f(()=>[i(le,null,{default:f(()=>[tt]),_:1})]),_:1})]),_:1})),[[se]]),ee((y(),U(ae,{clickable:"",class:"hover:tw-bg-primary hover:tw-text-black",onClick:t[3]||(t[3]=M(c=>n.value=!0,["stop"]))},{default:f(()=>[i(oe,null,{default:f(()=>[i(le,null,{default:f(()=>[ot]),_:1})]),_:1})]),_:1})),[[se]])]),_:1})]),_:1},8,["modelValue"])],64))}});var at=W(lt,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/DropdownWorkFlowManage.vue"]]);const st={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},rt={class:"q-pa-md tw-flex tw-flex-row-reverse tw-gap-4"},nt={class:"tw-w-full tw-grow tw-overflow-hidden tw-min-w-[280px]"},ut={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},it={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},dt={class:"task__remark"},ct={class:"task__bottom-box"},ft={class:"task__bottom-time"},wt={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},mt=E(" \u6682\u65E0\u6570\u636E "),vt=A({setup(o){const r=ue(),a=ce(),n=_(),d=S(()=>r.state.Root.loadingWorkflows);V(()=>a.name,l=>{(l==null?void 0:l.toString())==="workflows"&&s()});function m(l){const g=n.value;if(g===void 0)throw new Error("scroll-area instance is missing");const v=Array.from(t.value.keys()),u=v.findIndex(x=>x===l);setTimeout(()=>{if(u<0)g.setScrollPercentage("vertical",1);else{const x=1*u/v.length*g.getScroll().verticalSize-50;g.setScrollPosition("vertical",x)}},100)}ne(async()=>{r.watch(l=>[l.Root.eventWorkFlow],([l])=>{if(!l)return;const g=t.value.get(l.workFlowId);g!==void 0&&r.commit("notifySuccess",{message:`\u4EFB\u52A1\u7F16\u6392 ${g.title} \u5F53\u524D\u72B6\u6001: ${l.status}`}),s()}),V(()=>[t.value],()=>{const l=Number(a.params.workflowId);l!==0&&!isNaN(l)&&m(l)},{deep:!0})});const t=S(()=>r.state.WorkFlow.workflows);async function c(l,g){e.page=l,(await s()).length<e.pageSize?g(!0):g(!1)}const e=We({page:1,pageSize:5});async function s(){const[l]=await r.dispatch("WorkFlow/fetchWorkFlows",G({},e));return l}function h(l){return l.id===Number(a.params.workflowId||0)}function k(l){return l.state&&l.state.status==="running"}return(l,g)=>{const v=fe("router-link");return y(),Q("div",st,[b("div",rt,[i(H,{flat:"",loading:p(d),icon:"refresh",onClick:s},null,8,["loading"]),i(H,{flat:"",icon:"add",to:{name:"create_workflow"}})]),b("div",nt,[i(p(Le),{ref_key:"scrollArea",ref:n,visible:"","thumb-style":p(je),"bar-style":p(Oe),class:"tw-w-full tw-h-full tw-px-[15px]"},{default:f(()=>[i(p(Je),{class:"tw-w-full tw-h-full",offset:100,onLoad:c},{default:f(()=>[i(we,{class:"tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:f(()=>[(y(!0),Q(O,null,de(p(t),([,u])=>(y(),U(v,{key:u.id,to:{name:"workflow",params:{workflowId:u.id}}},{default:f(()=>[b("div",{class:j((h(u)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[b("div",ut,[b("div",it,[i(P,{name:"schedule",class:"tw-inline"}),E(" "+I(u.cronExpr),1)]),i(Ae),i($e,{outline:"",color:u.status===1?"green":"red",class:"tw-w-[50px]"},{default:f(()=>[E(I(k(u)?"\u6267\u884C\u4E2D":u.status==1?"\u8C03\u5EA6\u4E2D":"\u5DF2\u7EC8\u6B62"),1)]),_:2},1032,["color"]),te(` <div :class="'tw-w-[50px] task__status' + task.status"></div> `)]),b("div",{class:j((h(u)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[i(P,{name:"numbers"}),E(" "+I(u.title),1)],2),b("div",dt,I(u.remark||"-"),1),b("div",ct,[b("div",ft,I(p(He)(u.createTime*1e3)),1),i(at,{"workflow-id":u.id},null,8,["workflow-id"])])],2)]),_:2},1032,["to"]))),128))]),_:1})]),_:1})]),_:1},8,["thumb-style","bar-style"]),!p(d)&&(!p(t)||p(t).size===0)?(y(),Q("div",wt,[i(P,{name:"outlet",style:{"font-size":"3rem"}}),mt])):te("v-if",!0)])])}}});var pt=W(vt,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/WorkFlowList.vue"]]);const gt={class:"lg:q-pa-md tw-box-border tw-flex tw-flex-row tw-gap-4 tw-h-full tw-w-full"},_t={class:"tw-w-full tw-h-full tw-grow tw-overflow-hidden"},ht=A({setup(o){const r=ce(),a=S(()=>r.name&&r.name.toString()!=="workflows"?"tw-hidden lg:tw-block":"");return(n,d)=>{const m=fe("router-view");return y(),Q("div",gt,[b("div",{class:j("xl:tw-basis-1/5 lg:tw-basis-1/4  tw-h-full tw-w-full tw-shrink-0 "+p(a))},[i(pt)],2),b("div",_t,[i(m)])])}}});var Tt=W(ht,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/pages/WorkflowList.vue"]]);export{Tt as default};

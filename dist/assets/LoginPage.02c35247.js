import{j as B,l as h,E as C,x as o,aI as Q,r as d,bd as L,s as i,m as A,q as _,Q as p,t as I,F,u as N,B as O,D as S,cS as E,cT as M}from"./index.858abf03.js";import{Q as y}from"./QInput.39515e5e.js";import{Q as U}from"./QForm.44afa5f8.js";import{a as b}from"./utils.3d38ee44.js";import"./use-key-composition.89abe8dc.js";import"./focus-manager.2ec597e1.js";import"./uid.42677368.js";const j=["src"],$=o("div",{class:"tw-font-bold tw-text-md tw-text-center"},"GOPHERCRON",-1),T=B({props:{class:{type:String,default:""},src:{type:String,default:"/logo.png"}},setup(g){const n=g;return(r,u)=>(h(),C("div",{class:Q(n.class+" tw-flex tw-items-center tw-flex-col")},[o("img",{src:g.src,alt:"logo"},null,8,j),$],2))}}),z={class:"tw-h-full tw-bg-gradient-to-tl tw-from-primary tw-to-black tw-w-full tw-px-4"},G={class:"tw-flex tw-flex-col tw-items-center tw-justify-center tw-h-full tw-w-full"},H={class:"tw-bg-[#1D1D1D] tw-shadow tw-rounded tw-max-w-md lg:tw-w-1/3 sm:tw-w-2/3 tw-w-full tw-p-10 md:tw-mt-6 tw-mt-2"},P=F(" \u4F7F\u7528 OIDC \u767B\u5F55 "),W=o("p",{tabindex:"0",class:"focus:tw-outline-none tw-text-2xl tw-font-extrabold tw-leading-6"}," \u8D26\u53F7\u5BC6\u7801\u767B\u5F55 ",-1),J=o("p",{tabindex:"0",class:"tw-pb-8 focus:tw-outline-none tw-text-sm tw-mt-4 tw-font-medium tw-leading-none tw-text-gray-500"},[F(" \u6CA1\u6709\u8D26\u53F7? "),o("a",{href:"javascript:void(0)",class:"hover:text-gray-500 focus:text-gray-500 focus:outline-none focus:underline hover:underline text-sm font-medium leading-none text-gray-800 cursor-pointer"},"\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\u5F00\u901A")],-1),K=o("label",{id:"email",class:"tw-text-sm tw-font-medium tw-leading-none tw-text-white"},"\u8D26\u53F7",-1),X={class:"tw-mt-6 tw-w-full"},Y=o("label",{for:"pass",class:"tw-text-sm tw-font-medium tw-leading-none tw-text-white"},"\u5BC6\u7801",-1),Z={class:"tw-mt-8"},ut=B({setup(g){const n=d(""),r=d(""),u=N(),x=O(),w=S(),c=d(!1),a=d(!1);let f=b("code"),m=b("state");f||(f=w.query.code),m||(m=w.query.state),f&&m&&V(f,m);const v=d();async function D(){try{v.value=await E()}catch(t){console.error(t)}}D();async function V(t,e){if(a.value=!0,console.log("code",t,e),await u.dispatch("loginWithOIDC",{code:t,state:e}),u.state.Root.logined){const s=w.query.redirect;let l="/";typeof s=="string"?l=s:s&&s.length>0&&(l=s[0]||l),await x.push(l)}a.value=!1}async function k(){a.value=!0;try{const t=await M();window.location.href=t}catch(t){console.error(t),a.value=!1}}async function R(){if(c.value=!0,await u.dispatch("login",{username:n.value,password:r.value}),u.state.Root.logined){const t=w.query.redirect;let e="/";typeof t=="string"?e=t:t&&t.length>0&&(e=t[0]||e),await x.push(e)}c.value=!1}function q(){n.value="",r.value=""}return L(()=>u.dispatch("logout")),(t,e)=>{var s;return h(),C("div",z,[o("div",G,[i(T,{class:"tw-w-24 md:tw-w-32",src:"./logo_white.png"}),o("div",H,[(s=v.value)!=null&&s.oidc?(h(),A(p,{key:0,outline:"","text-color":"white",loading:a.value,disable:a.value||c.value,class:"focus:tw-ring-2 tw-mb-6 focus:tw-ring-offset-2 tw-font-semibold tw-leading-none tw-text-black tw-outline-non tw-border tw-rounded tw-py-2 tw-w-full",onClick:k},{default:_(()=>[P]),_:1},8,["loading","disable"])):I("",!0),W,J,i(U,{onSubmit:R,onReset:q},{default:_(()=>[o("div",null,[K,i(y,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),dense:"",type:"text",square:"",filled:""},null,8,["modelValue"])]),o("div",X,[Y,i(y,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=l=>r.value=l),dense:"",type:"password",square:"",filled:""},null,8,["modelValue"])]),o("div",Z,[i(p,{color:"primary",type:"submit",label:"\u767B\u5F55","text-color":"black",loading:c.value,disable:a.value||c.value,class:"focus:tw-ring-2 focus:tw-ring-offset-2 tw-font-semibold tw-leading-none tw-text-black tw-outline-non tw-border tw-rounded tw-py-2 tw-w-full"},null,8,["loading","disable"]),i(p,{color:"primary",type:"reset",label:"\u91CD\u7F6E",flat:"",class:"tw-text-sm tw-w-full tw-mt-3 tw-border tw-rounded"})])]),_:1})])])])}}});export{ut as default};

var st=Object.defineProperty;var H=Object.getOwnPropertySymbols;var at=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable;var K=(m,l,a)=>l in m?st(m,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[l]=a,C=(m,l)=>{for(var a in l||(l={}))at.call(l,a)&&K(m,a,l[a]);if(H)for(var a of H(l))ot.call(l,a)&&K(m,a,l[a]);return m};import{Q as lt,b as rt,a as U,c as R}from"./QTabPanels.579138ed.js";import{Q as nt}from"./QTooltip.72370141.js";import{_ as V,j as A,u as q,c as b,o as z,k as O,r as B,B as X,aS as L,l as _,E as y,s as e,z as s,x as n,q as u,y as h,Q as I,J as D,N as W,m as S,aY as T,F as x,I as k,t as j,D as N}from"./index.8ec00635.js";import{Q as P}from"./QInput.18ea454a.js";import{Q as Z,a as tt}from"./QBadge.b15bd9c0.js";import{Q as J}from"./QList.58a4b5dd.js";import{Q as M}from"./QScrollArea.ffe2066c.js";import{C as et}from"./Confirm.388454a6.js";import{f as Q}from"./datetime.6205e5a7.js";import{t as Y,b as G}from"./thumbStyle.856de4cb.js";import"./uid.42677368.js";import"./touch.8160dcd9.js";import"./use-prevent-scroll.c821079a.js";import"./focus-manager.5de30bde.js";import"./rtl.b51694b1.js";import"./use-key-composition.3f5e825f.js";import"./format.865294d5.js";import"./QDialog.fd4f138b.js";import"./ClosePopup.229815c6.js";const ut={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},it={class:"q-pa-md tw-flex tw-justify-around"},ct={class:"tw-w-full tw-grow"},dt={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},wt={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},mt={class:"task__remark"},pt={class:"task__bottom-box"},ft={class:"task__bottom-time"},_t={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},vt=x(" \u6682\u65E0\u6570\u636E "),kt=A({props:{projectId:{type:Number,required:!0}},setup(m){const l=m,a=q(),c=b(()=>a.state.Task.loadingTasks);z(()=>{O(async()=>{await p()}),a.watch(t=>[t.Root.eventTask],([t])=>{if(!t||t.projectId!==l.projectId)return;const o=i.value.find(E=>E.id===t.taskId);o!==void 0&&a.commit("notifySuccess",{message:`\u4EFB\u52A1 ${o.name} \u5F53\u524D\u72B6\u6001: ${t.status}`}),p()})});async function p(){await a.dispatch("Task/fetchTasks",C({},l))}const d=B(""),i=b(()=>{var t;return((t=a.state.Task.tasks.get(l.projectId))==null?void 0:t.filter(o=>o.name.indexOf(d.value)>=0||o.id.toString().indexOf(d.value)>=0))||[]});function v(t){return N().params.taskId===t.id}const f=b(()=>i.value.filter(v).pop()),g=X(),w=B(!1);async function $(t,o){a.commit("cleanError"),await a.dispatch("deleteTask",{projectId:t,taskId:o}),a.state.Root.currentError===void 0&&(g.push({name:"crontab_tasks",params:{projectId:t}}),w.value=!1,await p())}return(t,o)=>{var F;const E=L("router-link");return _(),y("div",ut,[e(et,{modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=r=>w.value=r),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1"+((F=s(f))==null?void 0:F.name)+"?",type:"warning",onConfirm:o[1]||(o[1]=r=>s(f)&&$(s(f).projectId,s(f).id))},null,8,["modelValue","content"]),n("div",it,[e(P,{modelValue:d.value,"onUpdate:modelValue":o[2]||(o[2]=r=>d.value=r),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:u(()=>[e(h,{name:"search"})]),_:1},8,["modelValue"]),e(I,{flat:"",dense:"",loading:s(c),icon:"refresh",onClick:p},null,8,["loading"]),e(I,{flat:"",dense:"",to:{name:"create_crontab_task"},icon:"add"}),e(I,{flat:"",dense:"",class:"tw-text-red-300 lg:tw-flex tw-hidden",icon:"delete",disable:!s(f),onClick:o[3]||(o[3]=r=>w.value=!0)},null,8,["disable"])]),n("div",ct,[e(M,{class:"tw-w-full tw-h-full tw-px-[15px]",visible:"","thumb-style":s(Y),"bar-style":s(G)},{default:u(()=>[e(J,{class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4 tw-overflow-hidden tw-relative"},{default:u(()=>[(_(!0),y(D,null,W(s(i),r=>(_(),S(E,{key:r.id,to:{name:"crontab_task",params:{taskId:r.id}}},{default:u(()=>[n("div",{class:T((v(r)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[n("div",dt,[n("div",wt,[e(h,{name:"schedule",class:"tw-inline"}),x(" "+k(r.cronExpr),1)]),e(Z),e(tt,{outline:"",color:r.status===1?"green":"red",class:"tw-w-[50px]"},{default:u(()=>[x(k(r.isRunning==1?"\u6267\u884C\u4E2D":r.status==1?"\u8C03\u5EA6\u4E2D":"\u5DF2\u7EC8\u6B62"),1)]),_:2},1032,["color"]),j(` <div :class="'tw-w-[50px] task__status' + task.status"></div> `)]),n("div",{class:T((v(r)?"active ":"")+"task__title tw-flex-col tw-items-center tw-w-full")},[e(h,{name:"numbers"}),x(" "+k(r.name),1)],2),n("div",mt,k(r.remark||"-"),1),n("div",pt,[n("div",ft,k(s(Q)(r.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1}),!s(c)&&(!s(i)||s(i).length===0)?(_(),y("div",_t,[e(h,{name:"outlet",style:{"font-size":"3rem"}}),vt])):j("v-if",!0)]),_:1},8,["thumb-style","bar-style"])])])}}});var ht=V(kt,[["__scopeId","data-v-189e9673"],["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/TaskList.vue"]]);const bt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},xt={class:"q-pa-md tw-flex tw-justify-around"},yt={class:"tw-w-full tw-grow"},gt={class:"tw-w-full tw-flex tw-gap-4 tw-overflow-hidden tw-px-[10px] tw-pt-[10px]"},Tt={class:"tw-text-ellipsis tw-w-auto tw-truncate tw-gap-1"},Et={class:"task__remark"},It={class:"task__bottom-box"},jt={class:"task__bottom-time"},$t={key:1,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},Ft=x(" \u6682\u65E0\u6570\u636E "),Ct=A({props:{projectId:{type:Number,required:!0}},setup(m){const l=m,a=B(""),c=q(),p=b(()=>c.state.Task.loadingTasks);async function d(){await c.dispatch("Task/fetchTasks",C({},l)),await c.dispatch("Task/fetchTemporaryTasks",C({},l))}z(async()=>{O(async()=>{await d()}),c.state.Task.tasks||await c.dispatch("Task/fetchTasks",{projectId:l.projectId})});const i=b(()=>c.state.Task.tasks.get(l.projectId)),v=b(()=>{var g;return((g=c.state.Task.temporaryTasks.get(l.projectId))==null?void 0:g.filter(w=>w.taskId.toString().indexOf(a.value)>=0))||[]});function f(g){const w=N();return Number(w.params.taskId)===g.id}return(g,w)=>{const $=L("router-link");return _(),y("div",bt,[n("div",xt,[e(P,{modelValue:a.value,"onUpdate:modelValue":w[0]||(w[0]=t=>a.value=t),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:u(()=>[e(h,{name:"search"})]),_:1},8,["modelValue"]),e(I,{flat:"",dense:"",loading:s(p),icon:"refresh",onClick:d},null,8,["loading"])]),n("div",yt,[e(M,{class:"tw-w-full tw-h-full tw-px-[15px]",visible:"","thumb-style":s(Y),"bar-style":s(G)},{default:u(()=>[s(i)?(_(),S(J,{key:0,class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:u(()=>[(_(!0),y(D,null,W(s(v),t=>(_(),S($,{key:t.id,to:{name:"temporary_task",params:{taskId:t.id}}},{default:u(()=>[n("div",{class:T((f(t)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[n("div",gt,[n("div",Tt,[e(h,{name:"schedule",class:"tw-inline"}),x(" "+k(s(Q)(t.scheduleTime*1e3)),1)]),e(Z),e(tt,{outline:"",color:t.scheduleStatus===1?"green":"red",class:"tw-w-[50px]"},{default:u(()=>[x(k(t.isRunning==1?"\u6267\u884C\u4E2D":t.scheduleStatus==1?"\u7B49\u5F85\u4E2D":"\u5DF2\u5B8C\u6210"),1)]),_:2},1032,["color"]),j(` <div :class="'tw-w-[50px] task__status' + task.status"></div> `)]),n("div",{class:T((f(t)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[e(h,{name:"numbers"}),x(" "+k(t.remark),1)],2),n("div",Et,"\u521B\u5EFA\u4EBA\uFF1A"+k(t.userName||"-"),1),n("div",It,[n("div",jt,k(s(Q)(t.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1})):j("v-if",!0),!s(p)&&(!s(v)||s(v).length===0)?(_(),y("div",$t,[e(h,{name:"outlet",style:{"font-size":"3rem"}}),Ft])):j("v-if",!0)]),_:1},8,["thumb-style","bar-style"])])])}}});var Bt=V(Ct,[["__scopeId","data-v-38f53198"],["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/TemporaryTaskList.vue"]]);const St={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Qt={class:"q-pa-md tw-flex tw-justify-around"},Vt={class:"tw-w-full tw-grow"},At={class:"task__remark"},Lt={class:"task__bottom-box"},Dt={class:"task__bottom-time"},Nt={key:0,class:"tw-w-full tw-text-center tw-m-auto tw-text-gray-500"},Ut=x(" \u6682\u65E0\u6570\u636E "),Rt=A({props:{projectId:{type:Number,required:!0}},setup(m){const l=m,a=q(),c=b(()=>a.state.WorkFlowTask.loadingTasks);z(()=>{O(async()=>{await p()}),a.watch(t=>[t.Root.eventWorkFlowTask],([t])=>{if(!t||t.projectId!==l.projectId)return;const o=i.value.find(E=>E.id===t.taskId);o!==void 0&&a.commit("notifySuccess",{message:`\u4EFB\u52A1 ${o.name} \u5F53\u524D\u72B6\u6001: ${t.status}`}),p()})});async function p(){await a.dispatch("WorkFlowTask/fetchTasks",C({},l))}const d=B(""),i=b(()=>{var t;return((t=a.state.WorkFlowTask.tasks.get(l.projectId))==null?void 0:t.filter(o=>o.name.indexOf(d.value)>=0||o.id.toString().indexOf(d.value)>=0))||[]});function v(t){return N().params.taskId===t.id}const f=b(()=>i.value.filter(v).pop()),g=X(),w=B(!1);async function $(t,o){a.commit("cleanError"),await a.dispatch("deleteWorkFlowTask",{projectId:t,taskId:o}),a.state.Root.currentError===void 0&&(g.push({name:"workflow_tasks",params:{projectId:t}}),w.value=!1,await p())}return(t,o)=>{var F;const E=L("router-link");return _(),y("div",St,[e(et,{modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=r=>w.value=r),content:"\u662F\u5426\u8981\u5220\u9664\u4EFB\u52A1"+((F=s(f))==null?void 0:F.name)+"?",type:"warning",onConfirm:o[1]||(o[1]=r=>s(f)&&$(s(f).projectId,s(f).id))},null,8,["modelValue","content"]),n("div",Qt,[e(P,{modelValue:d.value,"onUpdate:modelValue":o[2]||(o[2]=r=>d.value=r),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:u(()=>[e(h,{name:"search"})]),_:1},8,["modelValue"]),e(I,{flat:"",dense:"",loading:s(c),icon:"refresh",onClick:p},null,8,["loading"]),e(I,{flat:"",dense:"",to:{name:"create_workflow_task"},icon:"add"}),e(I,{flat:"",dense:"",class:"tw-text-red-300 lg:tw-flex tw-hidden",icon:"delete",disable:!s(f),onClick:o[3]||(o[3]=r=>w.value=!0)},null,8,["disable"])]),n("div",Vt,[e(M,{class:"tw-h-full tw-w-full tw-px-[15px]",visible:"","thumb-style":s(Y),"bar-style":s(G)},{default:u(()=>[e(J,{class:"tw-w-full tw-flex tw-flex-col tw-gap-2 tw-pb-4"},{default:u(()=>[(_(!0),y(D,null,W(s(i),r=>(_(),S(E,{key:r.id,to:{name:"workflow_task",params:{taskId:r.id}}},{default:u(()=>[n("div",{class:T((v(r)?"tw-bg-primary tw-text-black ":"tw-bg-[#27272a] ")+"tw-w-full tw-min-h-[130px] tw-py-3 tw-rounded-md tw-box-border tw-relative tw-overflow-hidden tw-block hover:tw-bg-primary hover:tw-text-black")},[n("div",{class:T((v(r)?"active ":"")+"task__title tw-inline-flex tw-items-center")},[e(h,{name:"numbers"}),x(" "+k(r.name),1)],2),n("div",At,k(r.remark||"-"),1),n("div",Lt,[n("div",Dt,k(s(Q)(r.createTime*1e3)),1)])],2)]),_:2},1032,["to"]))),128))]),_:1}),!s(c)&&(!s(i)||s(i).length===0)?(_(),y("div",Nt,[e(h,{name:"outlet",style:{"font-size":"3rem"}}),Ut])):j("v-if",!0)]),_:1},8,["thumb-style","bar-style"])])])}}});var qt=V(Rt,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/components/WorkFlowTaskList.vue"]]);const zt={class:"tw-h-full tw-w-full tw-flex tw-flex-col"},Ot=x(" \u6307\u5B9A\u65F6\u95F4\u8C03\u5EA6\u4E00\u6B21\u7684\u4EFB\u52A1 "),Wt=A({props:{projectId:{type:Number,required:!0}},setup(m){const l=m,a=N(),c=b(()=>a.name&&!["crontab_tasks","workflow_tasks","temporary_tasks"].includes(a.name.toString())),p=b(()=>{var d;if(a.name){const i=a.name.toString();if(i.search("crontab")>=0)return"normal";if(i.search("workflow")>=0)return"workflow";if(i.search("temporary")>=0)return"temporary"}throw new Error(`Unknown route name ${(d=a.name)==null?void 0:d.toString()}`)});return(d,i)=>{const v=L("router-view");return _(),y(D,null,[n("div",{class:T("xl:tw-basis-1/5 tw-basis-1/4 tw-w-full tw-h-full tw-bg-[#1E1E1E] tw-min-w-[280px]"+(s(c)?" tw-hidden lg:tw-block":""))},[n("div",zt,[e(lt,{"model-value":s(p),"active-color":"primary"},{default:u(()=>[e(U,{name:"crontab",label:"\u666E\u901A",to:{name:"crontab_tasks",params:{projectId:l.projectId}},replace:""},null,8,["to"]),e(U,{name:"temporary",label:"\u4E34\u65F6",to:{name:"temporary_tasks",params:{projectId:l.projectId}},replace:""},{default:u(()=>[e(nt,{class:"bg-warning tw-text-black",offset:[10,10]},{default:u(()=>[Ot]),_:1})]),_:1},8,["to"]),e(U,{name:"workflow",label:"\u4EFB\u52A1\u6D41",to:{name:"workflow_tasks",params:{projectId:l.projectId}},replace:""},null,8,["to"])]),_:1},8,["model-value"]),e(rt,{"model-value":s(p),animated:"",class:"tw-w-full tw-grow"},{default:u(()=>[e(R,{name:"normal",class:"tw-p-0"},{default:u(()=>[e(ht,{"project-id":l.projectId},null,8,["project-id"])]),_:1}),e(R,{name:"temporary",class:"tw-p-0"},{default:u(()=>[e(Bt,{"project-id":l.projectId},null,8,["project-id"])]),_:1}),e(R,{name:"workflow",class:"tw-p-0"},{default:u(()=>[e(qt,{"project-id":l.projectId},null,8,["project-id"])]),_:1})]),_:1},8,["model-value"])])],2),n("div",{class:T("xl:tw-basis-3/5 tw-basis-1/2 tw-h-full tw-w-full"+(s(c)?"":" tw-hidden lg:tw-block"))},[e(v)],2)],64)}}});var de=V(Wt,[["__file","/Users/boyan/development/opensource/gopherCronFE/src/pages/TaskList.vue"]]);export{de as default};
